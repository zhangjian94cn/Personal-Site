{
  "title": "江苏移动数智助手 Text2SQL 大模型微调实践",
  "date": "2024-08-03T00:00:00.000Z",
  "tags": [
    "LLM",
    "Text2SQL",
    "微调",
    "LoRA"
  ],
  "draft": false,
  "summary": "分享在数智助手项目中进行 Text2SQL 微调的实践经验，包括问题分析、训练数据准备、LoRA 微调过程及效果评估。",
  "authors": [
    "default"
  ],
  "body": {
    "raw": "\n> \"随着人工智能技术的迅猛发展，企业在数据处理和分析方面的需求也日益增长。为了更高效地从海量数据中提取有用信息，我们在数智助手中进行了Text2SQL微调实践。这不仅提高了数据查询的效率，还大幅提升了用户体验。\"\n\n## 问题分析\n\nText2SQL也称NL2SQL，指用自然语言向LLM提问，推理生成结构化SQL语句的过程。\n\n随着大语言模型的迅猛演进，通过LLM将自然语言表达的用户需求转化为SQL查询指令，已确立为解决复杂数据检索问题的首选方案。我们利用海量数据对大模型进行微调，从而增强其在新场景下的适应性和准确性，最终形成：**用户问题-SQL命令生成-SQL查询结果返回-查询结果总结输出的完整闭环**，实现可靠、准确的问答流程。\n\n在项目早期未引入Text2SQL时，针对用户套餐查询的需求，我们基于单纯RAG语义向量匹配和基座大模型能力，无法实现对用户问题的精准回答。\n\n### Text2SQL大模型现存问题\n\n在实践过程中，我们发现目前的Text2SQL中存在的一些主要问题包括：\n\n**(1) 输出幻觉（Hallucination）**：LLM在生成SQL语句时会生成一些看似合理，但实际与输入文本无关或错误的查询，这可能是由于模型尚未充分学习到数据库的信息和SQL逻辑，导致在推理阶段产生误导性的输出。例如，当用户提问：\"比语音翻倍包更经济的套餐有哪些？\"，生成的SQL命令为：\n\n```sql\n\"SELECT * FROM database WHERE money < 50;\"\n```\n\n大模型直接认为\"语音翻倍包\"的价格为50元，并以此输出SQL语句，导致查询结果出错。\n\n**(2) 答案稳定性**：模型生成答案不够稳定，偶尔需要多次提问才能找到最优答案。例如，用户多次提问\"请问流量超过3000MB有几种套餐\"，得到的回答会出现以下几种情况：\n\n```sql\nSELECT COUNT(*) FROM database WHERE en_names LIKE %'流量超过3000MB'%;\nSELECT COUNT(*) FROM database WHERE en_broadband > 3;\nSELECT COUNT(*) FROM database WHERE en_broadband > 3000;\n```\n\n在多次提问的过程中，出现了语义理解不清（将\"流量超过3000MB\"作为套餐名）、单位换算出错（MB转换成GB）的情况，暴露出大模型稳定性不强的问题。\n\n### 优化方法\n\n为了解决这些模型问题，我们考虑了**Prompt Engineering（提示工程）**、**Fine-tuning（模型微调）**等方式对模型进行优化。\n\n**(1) Prompt Engineering（提示工程）**能够通过设计特定的提示词或句子，引导模型生成更贴合用户意图的输出。在处理SQL查询时，向模型注入特定领域的知识，比如SQL规范、数据库架构以及注意单位转换等额外要求，能够显著提升模型对于SQL语句结构和逻辑的理解能力。\n\n**(2) Fine-tuning（模型微调）**是一种先进的机器学习技术，旨在针对预训练模型进行定制化调整，使其更加契合特定应用场景的需求。LoRA微调通过将模型的部分权重矩阵分解为两个低秩矩阵，只更新这两个小矩阵的参数来实现微调，**从而减少计算资源和内存占用**。\n\n## 微调训练数据准备\n\n### 生成方法\n\n(1) 提取关键属性信息，对业务知识提取关键属性及对应的信息。可抽取的关键属性为：\n\n```\n套餐名称：{names}\n套餐价格：{money}\n套餐流量：{GB}\n可通话时长：{duration}\n套餐上线年份：{online_years}\n```\n\n(2) 构建常见的用户问题与sql命令语料对，通过抽象化用户可能提问的问题，并进行对应的同义词替换，生成大量训练样本\n\n**示例1**：查询128元的套餐\n\n```sql\nSELECT * FROM {table_name} WHERE money = {money};\n```\n\n**示例2**：降档流量套餐到60G\n\n```sql\nSELECT * FROM {table_name} WHERE GB = {GB};\n```\n\n(3) 训练语料对保存为json格式\n\n```json\n{\n  \"user\": {\"升级到41GB流量的套餐，有什么建议\"},\n  \"assistant\": {\"SELECT * FROM database WHERE GB = 41000;\"}\n}\n```\n\n### 生成规模\n\n共生成**15w条语料对**，包括正向语料和反向语料：\n\n- **正向语料**（用户输入能够生成sql命令）：\n  - **直接查询类**：用户直接询问明确的套餐名称、价格，生成**5w条样本**\n  - **数字比较类**：用户希望找到更优惠、更多流量的套餐，生成**5w条样本**\n\n- **反向语料**（用户输入无法生成sql命令）：生成**5w条样本**\n\n## 微调过程\n\n1. 所需资源：**GPU：NVIDIA A100-SXM4-40GB x2**；**微调模型：QWen-7b-chat**\n\n2. 微调过程\n   - **训练时长**：大约3.75小时\n\n我们对微调后的模型进行测试，用户问题与SQL语句的转换正确率可达**98.56%**，达到了生产上线的标准。当我们将微调模型部署后，回答的套餐信息已明显扩充，并且从用户角度考虑了短期和长期两种情况，向用户提供了更全面、更可靠的答案。\n\n## 未来展望\n\n随着大模型技术的日新月异，Text2SQL技术也在以惊人的速度不断发展。目前所采用的优化手段，虽然在现阶段可能有效，但随着大模型能力的持续提升，这些手段很可能会逐渐显得过时。\n\n一方面，我们不能神话大型语言模型（LLM）的能力，给予其过高的期望。另一方面，我们也不能因高估工程实现的难度而望而生畏。只有一步一个脚印，踏踏实实地解决工程实践中的每一个问题，才能最终将Text2SQL技术推向成熟的生产阶段。\n",
    "code": "var Component=(()=>{var p=Object.create;var l=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var g=(a,n)=>()=>(n||a((n={exports:{}}).exports,n),n.exports),L=(a,n)=>{for(var s in n)l(a,s,{get:n[s],enumerable:!0})},i=(a,n,s,r)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let c of N(n))!k.call(a,c)&&c!==s&&l(a,c,{get:()=>n[c],enumerable:!(r=m(n,c))||r.enumerable});return a};var E=(a,n,s)=>(s=a!=null?p(u(a)):{},i(n||!a||!a.__esModule?l(s,\"default\",{value:a,enumerable:!0}):s,a)),S=a=>i(l({},\"__esModule\",{value:!0}),a);var d=g((Q,t)=>{t.exports=_jsx_runtime});var y={};L(y,{default:()=>h,frontmatter:()=>x});var e=E(d()),x={title:\"\\u6C5F\\u82CF\\u79FB\\u52A8\\u6570\\u667A\\u52A9\\u624B Text2SQL \\u5927\\u6A21\\u578B\\u5FAE\\u8C03\\u5B9E\\u8DF5\",date:\"2024-08-03\",tags:[\"LLM\",\"Text2SQL\",\"\\u5FAE\\u8C03\",\"LoRA\"],draft:!1,summary:\"\\u5206\\u4EAB\\u5728\\u6570\\u667A\\u52A9\\u624B\\u9879\\u76EE\\u4E2D\\u8FDB\\u884C Text2SQL \\u5FAE\\u8C03\\u7684\\u5B9E\\u8DF5\\u7ECF\\u9A8C\\uFF0C\\u5305\\u62EC\\u95EE\\u9898\\u5206\\u6790\\u3001\\u8BAD\\u7EC3\\u6570\\u636E\\u51C6\\u5907\\u3001LoRA \\u5FAE\\u8C03\\u8FC7\\u7A0B\\u53CA\\u6548\\u679C\\u8BC4\\u4F30\\u3002\",authors:[\"default\"]};function o(a){let n={a:\"a\",blockquote:\"blockquote\",code:\"code\",h2:\"h2\",h3:\"h3\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",ul:\"ul\",...a.components};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:'\"\\u968F\\u7740\\u4EBA\\u5DE5\\u667A\\u80FD\\u6280\\u672F\\u7684\\u8FC5\\u731B\\u53D1\\u5C55\\uFF0C\\u4F01\\u4E1A\\u5728\\u6570\\u636E\\u5904\\u7406\\u548C\\u5206\\u6790\\u65B9\\u9762\\u7684\\u9700\\u6C42\\u4E5F\\u65E5\\u76CA\\u589E\\u957F\\u3002\\u4E3A\\u4E86\\u66F4\\u9AD8\\u6548\\u5730\\u4ECE\\u6D77\\u91CF\\u6570\\u636E\\u4E2D\\u63D0\\u53D6\\u6709\\u7528\\u4FE1\\u606F\\uFF0C\\u6211\\u4EEC\\u5728\\u6570\\u667A\\u52A9\\u624B\\u4E2D\\u8FDB\\u884C\\u4E86Text2SQL\\u5FAE\\u8C03\\u5B9E\\u8DF5\\u3002\\u8FD9\\u4E0D\\u4EC5\\u63D0\\u9AD8\\u4E86\\u6570\\u636E\\u67E5\\u8BE2\\u7684\\u6548\\u7387\\uFF0C\\u8FD8\\u5927\\u5E45\\u63D0\\u5347\\u4E86\\u7528\\u6237\\u4F53\\u9A8C\\u3002\"'}),`\n`]}),`\n`,(0,e.jsxs)(n.h2,{id:\"\\u95EE\\u9898\\u5206\\u6790\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u95EE\\u9898\\u5206\\u6790\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u95EE\\u9898\\u5206\\u6790\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Text2SQL\\u4E5F\\u79F0NL2SQL\\uFF0C\\u6307\\u7528\\u81EA\\u7136\\u8BED\\u8A00\\u5411LLM\\u63D0\\u95EE\\uFF0C\\u63A8\\u7406\\u751F\\u6210\\u7ED3\\u6784\\u5316SQL\\u8BED\\u53E5\\u7684\\u8FC7\\u7A0B\\u3002\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u968F\\u7740\\u5927\\u8BED\\u8A00\\u6A21\\u578B\\u7684\\u8FC5\\u731B\\u6F14\\u8FDB\\uFF0C\\u901A\\u8FC7LLM\\u5C06\\u81EA\\u7136\\u8BED\\u8A00\\u8868\\u8FBE\\u7684\\u7528\\u6237\\u9700\\u6C42\\u8F6C\\u5316\\u4E3ASQL\\u67E5\\u8BE2\\u6307\\u4EE4\\uFF0C\\u5DF2\\u786E\\u7ACB\\u4E3A\\u89E3\\u51B3\\u590D\\u6742\\u6570\\u636E\\u68C0\\u7D22\\u95EE\\u9898\\u7684\\u9996\\u9009\\u65B9\\u6848\\u3002\\u6211\\u4EEC\\u5229\\u7528\\u6D77\\u91CF\\u6570\\u636E\\u5BF9\\u5927\\u6A21\\u578B\\u8FDB\\u884C\\u5FAE\\u8C03\\uFF0C\\u4ECE\\u800C\\u589E\\u5F3A\\u5176\\u5728\\u65B0\\u573A\\u666F\\u4E0B\\u7684\\u9002\\u5E94\\u6027\\u548C\\u51C6\\u786E\\u6027\\uFF0C\\u6700\\u7EC8\\u5F62\\u6210\\uFF1A\",(0,e.jsx)(n.strong,{children:\"\\u7528\\u6237\\u95EE\\u9898-SQL\\u547D\\u4EE4\\u751F\\u6210-SQL\\u67E5\\u8BE2\\u7ED3\\u679C\\u8FD4\\u56DE-\\u67E5\\u8BE2\\u7ED3\\u679C\\u603B\\u7ED3\\u8F93\\u51FA\\u7684\\u5B8C\\u6574\\u95ED\\u73AF\"}),\"\\uFF0C\\u5B9E\\u73B0\\u53EF\\u9760\\u3001\\u51C6\\u786E\\u7684\\u95EE\\u7B54\\u6D41\\u7A0B\\u3002\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5728\\u9879\\u76EE\\u65E9\\u671F\\u672A\\u5F15\\u5165Text2SQL\\u65F6\\uFF0C\\u9488\\u5BF9\\u7528\\u6237\\u5957\\u9910\\u67E5\\u8BE2\\u7684\\u9700\\u6C42\\uFF0C\\u6211\\u4EEC\\u57FA\\u4E8E\\u5355\\u7EAFRAG\\u8BED\\u4E49\\u5411\\u91CF\\u5339\\u914D\\u548C\\u57FA\\u5EA7\\u5927\\u6A21\\u578B\\u80FD\\u529B\\uFF0C\\u65E0\\u6CD5\\u5B9E\\u73B0\\u5BF9\\u7528\\u6237\\u95EE\\u9898\\u7684\\u7CBE\\u51C6\\u56DE\\u7B54\\u3002\"}),`\n`,(0,e.jsxs)(n.h3,{id:\"text2sql\\u5927\\u6A21\\u578B\\u73B0\\u5B58\\u95EE\\u9898\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#text2sql\\u5927\\u6A21\\u578B\\u73B0\\u5B58\\u95EE\\u9898\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Text2SQL\\u5927\\u6A21\\u578B\\u73B0\\u5B58\\u95EE\\u9898\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5728\\u5B9E\\u8DF5\\u8FC7\\u7A0B\\u4E2D\\uFF0C\\u6211\\u4EEC\\u53D1\\u73B0\\u76EE\\u524D\\u7684Text2SQL\\u4E2D\\u5B58\\u5728\\u7684\\u4E00\\u4E9B\\u4E3B\\u8981\\u95EE\\u9898\\u5305\\u62EC\\uFF1A\"}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"(1) \\u8F93\\u51FA\\u5E7B\\u89C9\\uFF08Hallucination\\uFF09\"}),'\\uFF1ALLM\\u5728\\u751F\\u6210SQL\\u8BED\\u53E5\\u65F6\\u4F1A\\u751F\\u6210\\u4E00\\u4E9B\\u770B\\u4F3C\\u5408\\u7406\\uFF0C\\u4F46\\u5B9E\\u9645\\u4E0E\\u8F93\\u5165\\u6587\\u672C\\u65E0\\u5173\\u6216\\u9519\\u8BEF\\u7684\\u67E5\\u8BE2\\uFF0C\\u8FD9\\u53EF\\u80FD\\u662F\\u7531\\u4E8E\\u6A21\\u578B\\u5C1A\\u672A\\u5145\\u5206\\u5B66\\u4E60\\u5230\\u6570\\u636E\\u5E93\\u7684\\u4FE1\\u606F\\u548CSQL\\u903B\\u8F91\\uFF0C\\u5BFC\\u81F4\\u5728\\u63A8\\u7406\\u9636\\u6BB5\\u4EA7\\u751F\\u8BEF\\u5BFC\\u6027\\u7684\\u8F93\\u51FA\\u3002\\u4F8B\\u5982\\uFF0C\\u5F53\\u7528\\u6237\\u63D0\\u95EE\\uFF1A\"\\u6BD4\\u8BED\\u97F3\\u7FFB\\u500D\\u5305\\u66F4\\u7ECF\\u6D4E\\u7684\\u5957\\u9910\\u6709\\u54EA\\u4E9B\\uFF1F\"\\uFF0C\\u751F\\u6210\\u7684SQL\\u547D\\u4EE4\\u4E3A\\uFF1A']}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsx)(n.code,{className:\"language-sql code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'\"SELECT * FROM database WHERE money < 50;\"'}),`\n`]})})}),`\n`,(0,e.jsx)(n.p,{children:'\\u5927\\u6A21\\u578B\\u76F4\\u63A5\\u8BA4\\u4E3A\"\\u8BED\\u97F3\\u7FFB\\u500D\\u5305\"\\u7684\\u4EF7\\u683C\\u4E3A50\\u5143\\uFF0C\\u5E76\\u4EE5\\u6B64\\u8F93\\u51FASQL\\u8BED\\u53E5\\uFF0C\\u5BFC\\u81F4\\u67E5\\u8BE2\\u7ED3\\u679C\\u51FA\\u9519\\u3002'}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"(2) \\u7B54\\u6848\\u7A33\\u5B9A\\u6027\"}),'\\uFF1A\\u6A21\\u578B\\u751F\\u6210\\u7B54\\u6848\\u4E0D\\u591F\\u7A33\\u5B9A\\uFF0C\\u5076\\u5C14\\u9700\\u8981\\u591A\\u6B21\\u63D0\\u95EE\\u624D\\u80FD\\u627E\\u5230\\u6700\\u4F18\\u7B54\\u6848\\u3002\\u4F8B\\u5982\\uFF0C\\u7528\\u6237\\u591A\\u6B21\\u63D0\\u95EE\"\\u8BF7\\u95EE\\u6D41\\u91CF\\u8D85\\u8FC73000MB\\u6709\\u51E0\\u79CD\\u5957\\u9910\"\\uFF0C\\u5F97\\u5230\\u7684\\u56DE\\u7B54\\u4F1A\\u51FA\\u73B0\\u4EE5\\u4E0B\\u51E0\\u79CD\\u60C5\\u51B5\\uFF1A']}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"COUNT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"database\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" en_names \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"LIKE\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"%\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'\\u6D41\\u91CF\\u8D85\\u8FC73000MB'\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"%\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"COUNT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"database\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" en_broadband \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"COUNT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"database\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" en_broadband \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3000\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:'\\u5728\\u591A\\u6B21\\u63D0\\u95EE\\u7684\\u8FC7\\u7A0B\\u4E2D\\uFF0C\\u51FA\\u73B0\\u4E86\\u8BED\\u4E49\\u7406\\u89E3\\u4E0D\\u6E05\\uFF08\\u5C06\"\\u6D41\\u91CF\\u8D85\\u8FC73000MB\"\\u4F5C\\u4E3A\\u5957\\u9910\\u540D\\uFF09\\u3001\\u5355\\u4F4D\\u6362\\u7B97\\u51FA\\u9519\\uFF08MB\\u8F6C\\u6362\\u6210GB\\uFF09\\u7684\\u60C5\\u51B5\\uFF0C\\u66B4\\u9732\\u51FA\\u5927\\u6A21\\u578B\\u7A33\\u5B9A\\u6027\\u4E0D\\u5F3A\\u7684\\u95EE\\u9898\\u3002'}),`\n`,(0,e.jsxs)(n.h3,{id:\"\\u4F18\\u5316\\u65B9\\u6CD5\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u4F18\\u5316\\u65B9\\u6CD5\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u4F18\\u5316\\u65B9\\u6CD5\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u4E3A\\u4E86\\u89E3\\u51B3\\u8FD9\\u4E9B\\u6A21\\u578B\\u95EE\\u9898\\uFF0C\\u6211\\u4EEC\\u8003\\u8651\\u4E86\",(0,e.jsx)(n.strong,{children:\"Prompt Engineering\\uFF08\\u63D0\\u793A\\u5DE5\\u7A0B\\uFF09\"}),\"\\u3001**Fine-tuning\\uFF08\\u6A21\\u578B\\u5FAE\\u8C03\\uFF09**\\u7B49\\u65B9\\u5F0F\\u5BF9\\u6A21\\u578B\\u8FDB\\u884C\\u4F18\\u5316\\u3002\"]}),`\n`,(0,e.jsx)(n.p,{children:\"**(1) Prompt Engineering\\uFF08\\u63D0\\u793A\\u5DE5\\u7A0B\\uFF09**\\u80FD\\u591F\\u901A\\u8FC7\\u8BBE\\u8BA1\\u7279\\u5B9A\\u7684\\u63D0\\u793A\\u8BCD\\u6216\\u53E5\\u5B50\\uFF0C\\u5F15\\u5BFC\\u6A21\\u578B\\u751F\\u6210\\u66F4\\u8D34\\u5408\\u7528\\u6237\\u610F\\u56FE\\u7684\\u8F93\\u51FA\\u3002\\u5728\\u5904\\u7406SQL\\u67E5\\u8BE2\\u65F6\\uFF0C\\u5411\\u6A21\\u578B\\u6CE8\\u5165\\u7279\\u5B9A\\u9886\\u57DF\\u7684\\u77E5\\u8BC6\\uFF0C\\u6BD4\\u5982SQL\\u89C4\\u8303\\u3001\\u6570\\u636E\\u5E93\\u67B6\\u6784\\u4EE5\\u53CA\\u6CE8\\u610F\\u5355\\u4F4D\\u8F6C\\u6362\\u7B49\\u989D\\u5916\\u8981\\u6C42\\uFF0C\\u80FD\\u591F\\u663E\\u8457\\u63D0\\u5347\\u6A21\\u578B\\u5BF9\\u4E8ESQL\\u8BED\\u53E5\\u7ED3\\u6784\\u548C\\u903B\\u8F91\\u7684\\u7406\\u89E3\\u80FD\\u529B\\u3002\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"**(2) Fine-tuning\\uFF08\\u6A21\\u578B\\u5FAE\\u8C03\\uFF09**\\u662F\\u4E00\\u79CD\\u5148\\u8FDB\\u7684\\u673A\\u5668\\u5B66\\u4E60\\u6280\\u672F\\uFF0C\\u65E8\\u5728\\u9488\\u5BF9\\u9884\\u8BAD\\u7EC3\\u6A21\\u578B\\u8FDB\\u884C\\u5B9A\\u5236\\u5316\\u8C03\\u6574\\uFF0C\\u4F7F\\u5176\\u66F4\\u52A0\\u5951\\u5408\\u7279\\u5B9A\\u5E94\\u7528\\u573A\\u666F\\u7684\\u9700\\u6C42\\u3002LoRA\\u5FAE\\u8C03\\u901A\\u8FC7\\u5C06\\u6A21\\u578B\\u7684\\u90E8\\u5206\\u6743\\u91CD\\u77E9\\u9635\\u5206\\u89E3\\u4E3A\\u4E24\\u4E2A\\u4F4E\\u79E9\\u77E9\\u9635\\uFF0C\\u53EA\\u66F4\\u65B0\\u8FD9\\u4E24\\u4E2A\\u5C0F\\u77E9\\u9635\\u7684\\u53C2\\u6570\\u6765\\u5B9E\\u73B0\\u5FAE\\u8C03\\uFF0C\",(0,e.jsx)(n.strong,{children:\"\\u4ECE\\u800C\\u51CF\\u5C11\\u8BA1\\u7B97\\u8D44\\u6E90\\u548C\\u5185\\u5B58\\u5360\\u7528\"}),\"\\u3002\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"\\u5FAE\\u8C03\\u8BAD\\u7EC3\\u6570\\u636E\\u51C6\\u5907\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u5FAE\\u8C03\\u8BAD\\u7EC3\\u6570\\u636E\\u51C6\\u5907\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u5FAE\\u8C03\\u8BAD\\u7EC3\\u6570\\u636E\\u51C6\\u5907\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"\\u751F\\u6210\\u65B9\\u6CD5\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u751F\\u6210\\u65B9\\u6CD5\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u751F\\u6210\\u65B9\\u6CD5\"]}),`\n`,(0,e.jsx)(n.p,{children:\"(1) \\u63D0\\u53D6\\u5173\\u952E\\u5C5E\\u6027\\u4FE1\\u606F\\uFF0C\\u5BF9\\u4E1A\\u52A1\\u77E5\\u8BC6\\u63D0\\u53D6\\u5173\\u952E\\u5C5E\\u6027\\u53CA\\u5BF9\\u5E94\\u7684\\u4FE1\\u606F\\u3002\\u53EF\\u62BD\\u53D6\\u7684\\u5173\\u952E\\u5C5E\\u6027\\u4E3A\\uFF1A\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-js\",children:(0,e.jsxs)(n.code,{className:\"language-js code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u5957\\u9910\\u540D\\u79F0\\uFF1A\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"names\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u5957\\u9910\\u4EF7\\u683C\\uFF1A\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"money\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u5957\\u9910\\u6D41\\u91CF\\uFF1A\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"GB\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u53EF\\u901A\\u8BDD\\u65F6\\u957F\\uFF1A\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"duration\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u5957\\u9910\\u4E0A\\u7EBF\\u5E74\\u4EFD\\uFF1A\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"online_years\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"(2) \\u6784\\u5EFA\\u5E38\\u89C1\\u7684\\u7528\\u6237\\u95EE\\u9898\\u4E0Esql\\u547D\\u4EE4\\u8BED\\u6599\\u5BF9\\uFF0C\\u901A\\u8FC7\\u62BD\\u8C61\\u5316\\u7528\\u6237\\u53EF\\u80FD\\u63D0\\u95EE\\u7684\\u95EE\\u9898\\uFF0C\\u5E76\\u8FDB\\u884C\\u5BF9\\u5E94\\u7684\\u540C\\u4E49\\u8BCD\\u66FF\\u6362\\uFF0C\\u751F\\u6210\\u5927\\u91CF\\u8BAD\\u7EC3\\u6837\\u672C\"}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"\\u793A\\u4F8B1\"}),\"\\uFF1A\\u67E5\\u8BE2128\\u5143\\u7684\\u5957\\u9910\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsx)(n.code,{className:\"language-sql code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" {table_name} \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" money \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" {money}\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"\\u793A\\u4F8B2\"}),\"\\uFF1A\\u964D\\u6863\\u6D41\\u91CF\\u5957\\u9910\\u523060G\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsx)(n.code,{className:\"language-sql code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" {table_name} \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" GB \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" {GB}\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),`\n`,(0,e.jsx)(n.p,{children:\"(3) \\u8BAD\\u7EC3\\u8BED\\u6599\\u5BF9\\u4FDD\\u5B58\\u4E3Ajson\\u683C\\u5F0F\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"language-json code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"user\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u5347\\u7EA7\\u523041GB\\u6D41\\u91CF\\u7684\\u5957\\u9910\\uFF0C\\u6709\\u4EC0\\u4E48\\u5EFA\\u8BAE\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"assistant\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"SELECT * FROM database WHERE GB = 41000;\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.h3,{id:\"\\u751F\\u6210\\u89C4\\u6A21\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u751F\\u6210\\u89C4\\u6A21\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u751F\\u6210\\u89C4\\u6A21\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u5171\\u751F\\u6210\",(0,e.jsx)(n.strong,{children:\"15w\\u6761\\u8BED\\u6599\\u5BF9\"}),\"\\uFF0C\\u5305\\u62EC\\u6B63\\u5411\\u8BED\\u6599\\u548C\\u53CD\\u5411\\u8BED\\u6599\\uFF1A\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"\\u6B63\\u5411\\u8BED\\u6599\"}),\"\\uFF08\\u7528\\u6237\\u8F93\\u5165\\u80FD\\u591F\\u751F\\u6210sql\\u547D\\u4EE4\\uFF09\\uFF1A\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u76F4\\u63A5\\u67E5\\u8BE2\\u7C7B\"}),\"\\uFF1A\\u7528\\u6237\\u76F4\\u63A5\\u8BE2\\u95EE\\u660E\\u786E\\u7684\\u5957\\u9910\\u540D\\u79F0\\u3001\\u4EF7\\u683C\\uFF0C\\u751F\\u6210\",(0,e.jsx)(n.strong,{children:\"5w\\u6761\\u6837\\u672C\"})]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u6570\\u5B57\\u6BD4\\u8F83\\u7C7B\"}),\"\\uFF1A\\u7528\\u6237\\u5E0C\\u671B\\u627E\\u5230\\u66F4\\u4F18\\u60E0\\u3001\\u66F4\\u591A\\u6D41\\u91CF\\u7684\\u5957\\u9910\\uFF0C\\u751F\\u6210\",(0,e.jsx)(n.strong,{children:\"5w\\u6761\\u6837\\u672C\"})]}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"\\u53CD\\u5411\\u8BED\\u6599\"}),\"\\uFF08\\u7528\\u6237\\u8F93\\u5165\\u65E0\\u6CD5\\u751F\\u6210sql\\u547D\\u4EE4\\uFF09\\uFF1A\\u751F\\u6210\",(0,e.jsx)(n.strong,{children:\"5w\\u6761\\u6837\\u672C\"})]}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.h2,{id:\"\\u5FAE\\u8C03\\u8FC7\\u7A0B\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u5FAE\\u8C03\\u8FC7\\u7A0B\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u5FAE\\u8C03\\u8FC7\\u7A0B\"]}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6240\\u9700\\u8D44\\u6E90\\uFF1A\",(0,e.jsx)(n.strong,{children:\"GPU\\uFF1ANVIDIA A100-SXM4-40GB x2\"}),\"\\uFF1B\",(0,e.jsx)(n.strong,{children:\"\\u5FAE\\u8C03\\u6A21\\u578B\\uFF1AQWen-7b-chat\"})]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:\"\\u5FAE\\u8C03\\u8FC7\\u7A0B\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u8BAD\\u7EC3\\u65F6\\u957F\"}),\"\\uFF1A\\u5927\\u7EA63.75\\u5C0F\\u65F6\"]}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6211\\u4EEC\\u5BF9\\u5FAE\\u8C03\\u540E\\u7684\\u6A21\\u578B\\u8FDB\\u884C\\u6D4B\\u8BD5\\uFF0C\\u7528\\u6237\\u95EE\\u9898\\u4E0ESQL\\u8BED\\u53E5\\u7684\\u8F6C\\u6362\\u6B63\\u786E\\u7387\\u53EF\\u8FBE\",(0,e.jsx)(n.strong,{children:\"98.56%\"}),\"\\uFF0C\\u8FBE\\u5230\\u4E86\\u751F\\u4EA7\\u4E0A\\u7EBF\\u7684\\u6807\\u51C6\\u3002\\u5F53\\u6211\\u4EEC\\u5C06\\u5FAE\\u8C03\\u6A21\\u578B\\u90E8\\u7F72\\u540E\\uFF0C\\u56DE\\u7B54\\u7684\\u5957\\u9910\\u4FE1\\u606F\\u5DF2\\u660E\\u663E\\u6269\\u5145\\uFF0C\\u5E76\\u4E14\\u4ECE\\u7528\\u6237\\u89D2\\u5EA6\\u8003\\u8651\\u4E86\\u77ED\\u671F\\u548C\\u957F\\u671F\\u4E24\\u79CD\\u60C5\\u51B5\\uFF0C\\u5411\\u7528\\u6237\\u63D0\\u4F9B\\u4E86\\u66F4\\u5168\\u9762\\u3001\\u66F4\\u53EF\\u9760\\u7684\\u7B54\\u6848\\u3002\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"\\u672A\\u6765\\u5C55\\u671B\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u672A\\u6765\\u5C55\\u671B\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u672A\\u6765\\u5C55\\u671B\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u968F\\u7740\\u5927\\u6A21\\u578B\\u6280\\u672F\\u7684\\u65E5\\u65B0\\u6708\\u5F02\\uFF0CText2SQL\\u6280\\u672F\\u4E5F\\u5728\\u4EE5\\u60CA\\u4EBA\\u7684\\u901F\\u5EA6\\u4E0D\\u65AD\\u53D1\\u5C55\\u3002\\u76EE\\u524D\\u6240\\u91C7\\u7528\\u7684\\u4F18\\u5316\\u624B\\u6BB5\\uFF0C\\u867D\\u7136\\u5728\\u73B0\\u9636\\u6BB5\\u53EF\\u80FD\\u6709\\u6548\\uFF0C\\u4F46\\u968F\\u7740\\u5927\\u6A21\\u578B\\u80FD\\u529B\\u7684\\u6301\\u7EED\\u63D0\\u5347\\uFF0C\\u8FD9\\u4E9B\\u624B\\u6BB5\\u5F88\\u53EF\\u80FD\\u4F1A\\u9010\\u6E10\\u663E\\u5F97\\u8FC7\\u65F6\\u3002\"}),`\n`,(0,e.jsx)(n.p,{children:\"\\u4E00\\u65B9\\u9762\\uFF0C\\u6211\\u4EEC\\u4E0D\\u80FD\\u795E\\u8BDD\\u5927\\u578B\\u8BED\\u8A00\\u6A21\\u578B\\uFF08LLM\\uFF09\\u7684\\u80FD\\u529B\\uFF0C\\u7ED9\\u4E88\\u5176\\u8FC7\\u9AD8\\u7684\\u671F\\u671B\\u3002\\u53E6\\u4E00\\u65B9\\u9762\\uFF0C\\u6211\\u4EEC\\u4E5F\\u4E0D\\u80FD\\u56E0\\u9AD8\\u4F30\\u5DE5\\u7A0B\\u5B9E\\u73B0\\u7684\\u96BE\\u5EA6\\u800C\\u671B\\u800C\\u751F\\u754F\\u3002\\u53EA\\u6709\\u4E00\\u6B65\\u4E00\\u4E2A\\u811A\\u5370\\uFF0C\\u8E0F\\u8E0F\\u5B9E\\u5B9E\\u5730\\u89E3\\u51B3\\u5DE5\\u7A0B\\u5B9E\\u8DF5\\u4E2D\\u7684\\u6BCF\\u4E00\\u4E2A\\u95EE\\u9898\\uFF0C\\u624D\\u80FD\\u6700\\u7EC8\\u5C06Text2SQL\\u6280\\u672F\\u63A8\\u5411\\u6210\\u719F\\u7684\\u751F\\u4EA7\\u9636\\u6BB5\\u3002\"})]})}function h(a={}){let{wrapper:n}=a.components||{};return n?(0,e.jsx)(n,{...a,children:(0,e.jsx)(o,{...a})}):o(a)}return S(y);})();\n;return Component;"
  },
  "_id": "blog/text2sql-finetuning-practice.mdx",
  "_raw": {
    "sourceFilePath": "blog/text2sql-finetuning-practice.mdx",
    "sourceFileName": "text2sql-finetuning-practice.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/text2sql-finetuning-practice"
  },
  "type": "Blog",
  "readingTime": {
    "text": "8 min read",
    "minutes": 7.59,
    "time": 455400,
    "words": 1518
  },
  "slug": "text2sql-finetuning-practice",
  "path": "blog/text2sql-finetuning-practice",
  "toc": [
    {
      "value": "问题分析",
      "url": "#问题分析",
      "depth": 2
    },
    {
      "value": "Text2SQL大模型现存问题",
      "url": "#text2sql大模型现存问题",
      "depth": 3
    },
    {
      "value": "优化方法",
      "url": "#优化方法",
      "depth": 3
    },
    {
      "value": "微调训练数据准备",
      "url": "#微调训练数据准备",
      "depth": 2
    },
    {
      "value": "生成方法",
      "url": "#生成方法",
      "depth": 3
    },
    {
      "value": "生成规模",
      "url": "#生成规模",
      "depth": 3
    },
    {
      "value": "微调过程",
      "url": "#微调过程",
      "depth": 2
    },
    {
      "value": "未来展望",
      "url": "#未来展望",
      "depth": 2
    }
  ],
  "structuredData": {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "江苏移动数智助手 Text2SQL 大模型微调实践",
    "datePublished": "2024-08-03T00:00:00.000Z",
    "dateModified": "2024-08-03T00:00:00.000Z",
    "description": "分享在数智助手项目中进行 Text2SQL 微调的实践经验，包括问题分析、训练数据准备、LoRA 微调过程及效果评估。",
    "url": "https://zhangjian94cn.github.io/blog/text2sql-finetuning-practice"
  }
}