{
  "title": "Text2SQL 大模型微调实战",
  "date": "2026-01-28T00:00:00.000Z",
  "tags": [
    "LLM",
    "Fine-tuning",
    "LoRA",
    "Text2SQL"
  ],
  "draft": false,
  "summary": "分享基于 LoRA 微调 Qwen-7B 实现自然语言转 SQL 的完整流程，准确率达到 98.56%。",
  "authors": [
    "default"
  ],
  "body": {
    "raw": "\n## 项目背景\n\n在企业数据分析场景中，非技术人员往往需要通过 SQL 查询数据库。Text2SQL 技术可以让用户用自然语言描述需求，自动生成对应的 SQL 语句。\n\n## 技术方案\n\n### 模型选择\n\n选择 Qwen-7B 作为基础模型，原因：\n\n- 中文理解能力强\n- 参数量适中，可在单卡 A100 上微调\n- 社区活跃，资料丰富\n\n### LoRA 微调\n\n使用 LoRA (Low-Rank Adaptation) 进行高效微调：\n\n```python\nfrom peft import LoraConfig, get_peft_model\n\nlora_config = LoraConfig(\n    r=16,\n    lora_alpha=32,\n    target_modules=[\"q_proj\", \"v_proj\"],\n    lora_dropout=0.05,\n    bias=\"none\",\n    task_type=\"CAUSAL_LM\"\n)\n\nmodel = get_peft_model(base_model, lora_config)\n```\n\n### 数据集构建\n\n基于 Spider 和 WikiSQL 数据集，构建了 10 万条中英文混合样本：\n\n| 数据集   | 样本数 | 表数量 |\n| -------- | ------ | ------ |\n| Spider   | 7000   | 200    |\n| WikiSQL  | 80000  | 26000  |\n| 自建数据 | 13000  | 150    |\n\n## 实验结果\n\n在测试集上的准确率：\n\n- **执行准确率**: 98.56%\n- **精确匹配率**: 87.3%\n- **推理速度**: 50ms/query\n\n## 总结\n\n通过 LoRA 微调可以在有限资源下获得优秀效果。下一步计划探索多轮对话场景下的 SQL 生成。\n",
    "code": "var Component=(()=>{var p=Object.create;var s=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var g=(a,n)=>()=>(n||a((n={exports:{}}).exports,n),n.exports),f=(a,n)=>{for(var c in n)s(a,c,{get:n[c],enumerable:!0})},r=(a,n,c,i)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let l of N(n))!k.call(a,l)&&l!==c&&s(a,l,{get:()=>n[l],enumerable:!(i=m(n,l))||i.enumerable});return a};var L=(a,n,c)=>(c=a!=null?p(u(a)):{},r(n||!a||!a.__esModule?s(c,\"default\",{value:a,enumerable:!0}):c,a)),_=a=>r(s({},\"__esModule\",{value:!0}),a);var d=g((y,t)=>{t.exports=_jsx_runtime});var b={};f(b,{default:()=>h,frontmatter:()=>x});var e=L(d()),x={title:\"Text2SQL \\u5927\\u6A21\\u578B\\u5FAE\\u8C03\\u5B9E\\u6218\",date:\"2026-01-28\",tags:[\"LLM\",\"Fine-tuning\",\"LoRA\",\"Text2SQL\"],draft:!1,summary:\"\\u5206\\u4EAB\\u57FA\\u4E8E LoRA \\u5FAE\\u8C03 Qwen-7B \\u5B9E\\u73B0\\u81EA\\u7136\\u8BED\\u8A00\\u8F6C SQL \\u7684\\u5B8C\\u6574\\u6D41\\u7A0B\\uFF0C\\u51C6\\u786E\\u7387\\u8FBE\\u5230 98.56%\\u3002\",authors:[\"default\"]};function o(a){let n={a:\"a\",code:\"code\",h2:\"h2\",h3:\"h3\",li:\"li\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",table:\"table\",tbody:\"tbody\",td:\"td\",th:\"th\",thead:\"thead\",tr:\"tr\",ul:\"ul\",...a.components};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"\\u9879\\u76EE\\u80CC\\u666F\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u9879\\u76EE\\u80CC\\u666F\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u9879\\u76EE\\u80CC\\u666F\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5728\\u4F01\\u4E1A\\u6570\\u636E\\u5206\\u6790\\u573A\\u666F\\u4E2D\\uFF0C\\u975E\\u6280\\u672F\\u4EBA\\u5458\\u5F80\\u5F80\\u9700\\u8981\\u901A\\u8FC7 SQL \\u67E5\\u8BE2\\u6570\\u636E\\u5E93\\u3002Text2SQL \\u6280\\u672F\\u53EF\\u4EE5\\u8BA9\\u7528\\u6237\\u7528\\u81EA\\u7136\\u8BED\\u8A00\\u63CF\\u8FF0\\u9700\\u6C42\\uFF0C\\u81EA\\u52A8\\u751F\\u6210\\u5BF9\\u5E94\\u7684 SQL \\u8BED\\u53E5\\u3002\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"\\u6280\\u672F\\u65B9\\u6848\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u6280\\u672F\\u65B9\\u6848\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u6280\\u672F\\u65B9\\u6848\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"\\u6A21\\u578B\\u9009\\u62E9\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u6A21\\u578B\\u9009\\u62E9\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u6A21\\u578B\\u9009\\u62E9\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u9009\\u62E9 Qwen-7B \\u4F5C\\u4E3A\\u57FA\\u7840\\u6A21\\u578B\\uFF0C\\u539F\\u56E0\\uFF1A\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"\\u4E2D\\u6587\\u7406\\u89E3\\u80FD\\u529B\\u5F3A\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u53C2\\u6570\\u91CF\\u9002\\u4E2D\\uFF0C\\u53EF\\u5728\\u5355\\u5361 A100 \\u4E0A\\u5FAE\\u8C03\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u793E\\u533A\\u6D3B\\u8DC3\\uFF0C\\u8D44\\u6599\\u4E30\\u5BCC\"}),`\n`]}),`\n`,(0,e.jsxs)(n.h3,{id:\"lora-\\u5FAE\\u8C03\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#lora-\\u5FAE\\u8C03\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"LoRA \\u5FAE\\u8C03\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u4F7F\\u7528 LoRA (Low-Rank Adaptation) \\u8FDB\\u884C\\u9AD8\\u6548\\u5FAE\\u8C03\\uFF1A\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" peft \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" LoraConfig\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),` get_peft_model\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"lora_config \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" LoraConfig\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    r\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"16\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    lora_alpha\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"32\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    target_modules\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"q_proj\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"v_proj\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    lora_dropout\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0.05\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    bias\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"none\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    task_type\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"CAUSAL_LM\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"model \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" get_peft_model\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"base_model\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" lora_config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.h3,{id:\"\\u6570\\u636E\\u96C6\\u6784\\u5EFA\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u6570\\u636E\\u96C6\\u6784\\u5EFA\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u6570\\u636E\\u96C6\\u6784\\u5EFA\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u57FA\\u4E8E Spider \\u548C WikiSQL \\u6570\\u636E\\u96C6\\uFF0C\\u6784\\u5EFA\\u4E86 10 \\u4E07\\u6761\\u4E2D\\u82F1\\u6587\\u6DF7\\u5408\\u6837\\u672C\\uFF1A\"}),`\n`,(0,e.jsxs)(n.table,{children:[(0,e.jsx)(n.thead,{children:(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.th,{children:\"\\u6570\\u636E\\u96C6\"}),(0,e.jsx)(n.th,{children:\"\\u6837\\u672C\\u6570\"}),(0,e.jsx)(n.th,{children:\"\\u8868\\u6570\\u91CF\"})]})}),(0,e.jsxs)(n.tbody,{children:[(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:\"Spider\"}),(0,e.jsx)(n.td,{children:\"7000\"}),(0,e.jsx)(n.td,{children:\"200\"})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:\"WikiSQL\"}),(0,e.jsx)(n.td,{children:\"80000\"}),(0,e.jsx)(n.td,{children:\"26000\"})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:\"\\u81EA\\u5EFA\\u6570\\u636E\"}),(0,e.jsx)(n.td,{children:\"13000\"}),(0,e.jsx)(n.td,{children:\"150\"})]})]})]}),`\n`,(0,e.jsxs)(n.h2,{id:\"\\u5B9E\\u9A8C\\u7ED3\\u679C\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u5B9E\\u9A8C\\u7ED3\\u679C\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u5B9E\\u9A8C\\u7ED3\\u679C\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5728\\u6D4B\\u8BD5\\u96C6\\u4E0A\\u7684\\u51C6\\u786E\\u7387\\uFF1A\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u6267\\u884C\\u51C6\\u786E\\u7387\"}),\": 98.56%\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u7CBE\\u786E\\u5339\\u914D\\u7387\"}),\": 87.3%\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u63A8\\u7406\\u901F\\u5EA6\"}),\": 50ms/query\"]}),`\n`]}),`\n`,(0,e.jsxs)(n.h2,{id:\"\\u603B\\u7ED3\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u603B\\u7ED3\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u603B\\u7ED3\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u901A\\u8FC7 LoRA \\u5FAE\\u8C03\\u53EF\\u4EE5\\u5728\\u6709\\u9650\\u8D44\\u6E90\\u4E0B\\u83B7\\u5F97\\u4F18\\u79C0\\u6548\\u679C\\u3002\\u4E0B\\u4E00\\u6B65\\u8BA1\\u5212\\u63A2\\u7D22\\u591A\\u8F6E\\u5BF9\\u8BDD\\u573A\\u666F\\u4E0B\\u7684 SQL \\u751F\\u6210\\u3002\"})]})}function h(a={}){let{wrapper:n}=a.components||{};return n?(0,e.jsx)(n,{...a,children:(0,e.jsx)(o,{...a})}):o(a)}return _(b);})();\n;return Component;"
  },
  "_id": "blog/text2sql-lora-finetuning.mdx",
  "_raw": {
    "sourceFilePath": "blog/text2sql-lora-finetuning.mdx",
    "sourceFileName": "text2sql-lora-finetuning.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/text2sql-lora-finetuning"
  },
  "type": "Blog",
  "readingTime": {
    "text": "2 min read",
    "minutes": 1.375,
    "time": 82500,
    "words": 275
  },
  "slug": "text2sql-lora-finetuning",
  "path": "blog/text2sql-lora-finetuning",
  "toc": [
    {
      "value": "项目背景",
      "url": "#项目背景",
      "depth": 2
    },
    {
      "value": "技术方案",
      "url": "#技术方案",
      "depth": 2
    },
    {
      "value": "模型选择",
      "url": "#模型选择",
      "depth": 3
    },
    {
      "value": "LoRA 微调",
      "url": "#lora-微调",
      "depth": 3
    },
    {
      "value": "数据集构建",
      "url": "#数据集构建",
      "depth": 3
    },
    {
      "value": "实验结果",
      "url": "#实验结果",
      "depth": 2
    },
    {
      "value": "总结",
      "url": "#总结",
      "depth": 2
    }
  ],
  "structuredData": {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Text2SQL 大模型微调实战",
    "datePublished": "2026-01-28T00:00:00.000Z",
    "dateModified": "2026-01-28T00:00:00.000Z",
    "description": "分享基于 LoRA 微调 Qwen-7B 实现自然语言转 SQL 的完整流程，准确率达到 98.56%。",
    "url": "https://zhangjian94cn.github.io/blog/text2sql-lora-finetuning"
  }
}