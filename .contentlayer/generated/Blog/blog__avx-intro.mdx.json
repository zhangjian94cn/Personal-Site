{
  "title": "AVX 指令入门",
  "date": "2022-11-19T00:00:00.000Z",
  "tags": [
    "HPC",
    "AVX",
    "SIMD",
    "性能优化"
  ],
  "draft": false,
  "summary": "介绍 SIMD 向量化指令的基础概念，包括自动向量化与手动向量化的实现方式和性能对比。",
  "authors": [
    "default"
  ],
  "body": {
    "raw": "\n## 简介\n\nSIMD（Single Instruction Multiple Data）是指一条指令能够操作多个数据，是对 CPU 指令的扩展，主要用来进行小数据的并行操作。\n\n> Intel 最初支持 SIMD 的指令集是 1996 年集成在 Pentium 里的 MMX（Multi-Media Extension，多媒体扩展），它的主要目标是为了支持 MPEG 视频解码。Intel 在 1999 年 Pentium3 中推出了 SSE（Streaming SIMD Extensions，流式SIMD扩展），是继 MMX 的扩展指令集，主要用于 3D 图形计算。Intel 在 2008 年 3 月份提出了 AVX 指令集（Advanced Vector Extension，高级向量扩展），它是 SSE 延伸架构，将 SSE 中的 16 个 128 位 XMM 寄存器扩展为 16 个 256 位 YMM 寄存器，增加了一倍的运算效率。 (CSAPP)\n\n## 实现\n\n使用 AVX 指令加速代码主要有两种方式：\n\n**自动向量化**：intel C++ 编译器进行自动向量化，需要使用 `-xhost` 编译选项。在 gcc 编译器中的对应选项为 `-march=native`。开启该选项后，编译器会自动根据 CPU 支持的指令集进行向量化。\n\n**手动向量化**：主要使用 [Intel Intrinsics](https://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html) 中的指令进行代码程序的编写。\n\n### 自动向量化\n\n对于代码的指定部分进行向量化可以加上编译宏：\n\n```cpp\nvoid auto_vec(float* a, float* b, int* idx) {\n    #pragma ivdep\n    #pragma vector always\n    for (int j = 0; j < 1024; ++ j) {\n        a[idx[j]] += b[j];\n    }\n}\n```\n\n**速度比较**：当使用 `icc -O3 -xhost` 的编译指令时，运行 100m 次，相较于 `g++ -O3`，向量化的编译方式能够获得 2 倍左右的速度提升。\n\n观察输出文件的汇编代码，可以看到向量化指令的使用：\n\n```asm\n402ee0:       c4 81 7c 10 14 88       vmovups (%r8,%r9,4),%ymm2\n402ee6:       c4 81 7c 10 64 88 20    vmovups 0x20(%r8,%r9,4),%ymm4\n402eed:       c5 fc 57 c0             vxorps %ymm0,%ymm0,%ymm0\n402ef1:       62 f1 7d 08 74 c8       vpcmpeqb %xmm0,%xmm0,%k1\n402ef7:       c5 f4 57 c9             vxorps %ymm1,%ymm1,%ymm1\n402efb:       62 f2 7d 29 92 04 97    vgatherdps (%rdi,%ymm2,4),%ymm0\n```\n\n### 手动向量化\n\n下面是相同代码的手动向量化实现：\n\n```cpp\nvoid core_intrinsics(std::vector<float>& a, std::vector<float>& b, int* idx) {\n    for (int j = 0; j < 1024; j += 16) {\n        __m512i _idx = _mm512_load_epi32(idx + j);\n        __m512 _b512 = _mm512_load_ps(b.data() + j);\n        __m512 _a512 = _mm512_i32gather_ps(_idx, a.data(), 4);\n\n        __m512 _res = _mm512_add_ps(_a512, _b512);\n        _mm512_i32scatter_ps(a.data(), _idx, _res, 4);\n    }\n}\n```\n\n有兴趣的可以自己尝试，比较两种方法的速度以及背后的原因。\n\n## 结论\n\n通过上面的简单实验，我们初步认知了向量化的两种实现方式。但是如何能更好地利用 AVX 指令的优势，需要考虑具体的代码。影响性能的核心因素是 memory bound 还是 compute bound，代码程序是否能实现指令上的并行，代码的关键路径是什么等等都是我们需要考虑的。\n",
    "code": "var Component=(()=>{var m=Object.create;var l=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var _=(a,n)=>()=>(n||a((n={exports:{}}).exports,n),n.exports),f=(a,n)=>{for(var s in n)l(a,s,{get:n[s],enumerable:!0})},o=(a,n,s,t)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let c of u(n))!k.call(a,c)&&c!==s&&l(a,c,{get:()=>n[c],enumerable:!(t=h(n,c))||t.enumerable});return a};var x=(a,n,s)=>(s=a!=null?m(N(a)):{},o(n||!a||!a.__esModule?l(s,\"default\",{value:a,enumerable:!0}):s,a)),g=a=>o(l({},\"__esModule\",{value:!0}),a);var r=_((v,i)=>{i.exports=_jsx_runtime});var b={};f(b,{default:()=>p,frontmatter:()=>y});var e=x(r()),y={title:\"AVX \\u6307\\u4EE4\\u5165\\u95E8\",date:\"2022-11-19\",tags:[\"HPC\",\"AVX\",\"SIMD\",\"\\u6027\\u80FD\\u4F18\\u5316\"],draft:!1,summary:\"\\u4ECB\\u7ECD SIMD \\u5411\\u91CF\\u5316\\u6307\\u4EE4\\u7684\\u57FA\\u7840\\u6982\\u5FF5\\uFF0C\\u5305\\u62EC\\u81EA\\u52A8\\u5411\\u91CF\\u5316\\u4E0E\\u624B\\u52A8\\u5411\\u91CF\\u5316\\u7684\\u5B9E\\u73B0\\u65B9\\u5F0F\\u548C\\u6027\\u80FD\\u5BF9\\u6BD4\\u3002\",authors:[\"default\"]};function d(a){let n={a:\"a\",blockquote:\"blockquote\",code:\"code\",h2:\"h2\",h3:\"h3\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",...a.components};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"\\u7B80\\u4ECB\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u7B80\\u4ECB\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u7B80\\u4ECB\"]}),`\n`,(0,e.jsx)(n.p,{children:\"SIMD\\uFF08Single Instruction Multiple Data\\uFF09\\u662F\\u6307\\u4E00\\u6761\\u6307\\u4EE4\\u80FD\\u591F\\u64CD\\u4F5C\\u591A\\u4E2A\\u6570\\u636E\\uFF0C\\u662F\\u5BF9 CPU \\u6307\\u4EE4\\u7684\\u6269\\u5C55\\uFF0C\\u4E3B\\u8981\\u7528\\u6765\\u8FDB\\u884C\\u5C0F\\u6570\\u636E\\u7684\\u5E76\\u884C\\u64CD\\u4F5C\\u3002\"}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:\"Intel \\u6700\\u521D\\u652F\\u6301 SIMD \\u7684\\u6307\\u4EE4\\u96C6\\u662F 1996 \\u5E74\\u96C6\\u6210\\u5728 Pentium \\u91CC\\u7684 MMX\\uFF08Multi-Media Extension\\uFF0C\\u591A\\u5A92\\u4F53\\u6269\\u5C55\\uFF09\\uFF0C\\u5B83\\u7684\\u4E3B\\u8981\\u76EE\\u6807\\u662F\\u4E3A\\u4E86\\u652F\\u6301 MPEG \\u89C6\\u9891\\u89E3\\u7801\\u3002Intel \\u5728 1999 \\u5E74 Pentium3 \\u4E2D\\u63A8\\u51FA\\u4E86 SSE\\uFF08Streaming SIMD Extensions\\uFF0C\\u6D41\\u5F0FSIMD\\u6269\\u5C55\\uFF09\\uFF0C\\u662F\\u7EE7 MMX \\u7684\\u6269\\u5C55\\u6307\\u4EE4\\u96C6\\uFF0C\\u4E3B\\u8981\\u7528\\u4E8E 3D \\u56FE\\u5F62\\u8BA1\\u7B97\\u3002Intel \\u5728 2008 \\u5E74 3 \\u6708\\u4EFD\\u63D0\\u51FA\\u4E86 AVX \\u6307\\u4EE4\\u96C6\\uFF08Advanced Vector Extension\\uFF0C\\u9AD8\\u7EA7\\u5411\\u91CF\\u6269\\u5C55\\uFF09\\uFF0C\\u5B83\\u662F SSE \\u5EF6\\u4F38\\u67B6\\u6784\\uFF0C\\u5C06 SSE \\u4E2D\\u7684 16 \\u4E2A 128 \\u4F4D XMM \\u5BC4\\u5B58\\u5668\\u6269\\u5C55\\u4E3A 16 \\u4E2A 256 \\u4F4D YMM \\u5BC4\\u5B58\\u5668\\uFF0C\\u589E\\u52A0\\u4E86\\u4E00\\u500D\\u7684\\u8FD0\\u7B97\\u6548\\u7387\\u3002 (CSAPP)\"}),`\n`]}),`\n`,(0,e.jsxs)(n.h2,{id:\"\\u5B9E\\u73B0\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u5B9E\\u73B0\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u5B9E\\u73B0\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u4F7F\\u7528 AVX \\u6307\\u4EE4\\u52A0\\u901F\\u4EE3\\u7801\\u4E3B\\u8981\\u6709\\u4E24\\u79CD\\u65B9\\u5F0F\\uFF1A\"}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"\\u81EA\\u52A8\\u5411\\u91CF\\u5316\"}),\"\\uFF1Aintel C++ \\u7F16\\u8BD1\\u5668\\u8FDB\\u884C\\u81EA\\u52A8\\u5411\\u91CF\\u5316\\uFF0C\\u9700\\u8981\\u4F7F\\u7528 \",(0,e.jsx)(n.code,{children:\"-xhost\"}),\" \\u7F16\\u8BD1\\u9009\\u9879\\u3002\\u5728 gcc \\u7F16\\u8BD1\\u5668\\u4E2D\\u7684\\u5BF9\\u5E94\\u9009\\u9879\\u4E3A \",(0,e.jsx)(n.code,{children:\"-march=native\"}),\"\\u3002\\u5F00\\u542F\\u8BE5\\u9009\\u9879\\u540E\\uFF0C\\u7F16\\u8BD1\\u5668\\u4F1A\\u81EA\\u52A8\\u6839\\u636E CPU \\u652F\\u6301\\u7684\\u6307\\u4EE4\\u96C6\\u8FDB\\u884C\\u5411\\u91CF\\u5316\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"\\u624B\\u52A8\\u5411\\u91CF\\u5316\"}),\"\\uFF1A\\u4E3B\\u8981\\u4F7F\\u7528 \",(0,e.jsx)(n.a,{href:\"https://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html\",children:\"Intel Intrinsics\"}),\" \\u4E2D\\u7684\\u6307\\u4EE4\\u8FDB\\u884C\\u4EE3\\u7801\\u7A0B\\u5E8F\\u7684\\u7F16\\u5199\\u3002\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"\\u81EA\\u52A8\\u5411\\u91CF\\u5316\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u81EA\\u52A8\\u5411\\u91CF\\u5316\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u81EA\\u52A8\\u5411\\u91CF\\u5316\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5BF9\\u4E8E\\u4EE3\\u7801\\u7684\\u6307\\u5B9A\\u90E8\\u5206\\u8FDB\\u884C\\u5411\\u91CF\\u5316\\u53EF\\u4EE5\\u52A0\\u4E0A\\u7F16\\u8BD1\\u5B8F\\uFF1A\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-cpp\",children:(0,e.jsxs)(n.code,{className:\"language-cpp code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"auto_vec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"float\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" a\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"float\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" idx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsxs)(n.span,{className:\"token macro property\",children:[(0,e.jsx)(n.span,{className:\"token directive-hash\",children:\"#\"}),(0,e.jsx)(n.span,{className:\"token directive keyword\",children:\"pragma\"}),\" \",(0,e.jsx)(n.span,{className:\"token expression\",children:\"ivdep\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsxs)(n.span,{className:\"token macro property\",children:[(0,e.jsx)(n.span,{className:\"token directive-hash\",children:\"#\"}),(0,e.jsx)(n.span,{className:\"token directive keyword\",children:\"pragma\"}),\" \",(0,e.jsx)(n.span,{className:\"token expression\",children:\"vector always\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" j \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" j \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1024\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"++\"}),\" j\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        a\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"idx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"j\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"\\u901F\\u5EA6\\u6BD4\\u8F83\"}),\"\\uFF1A\\u5F53\\u4F7F\\u7528 \",(0,e.jsx)(n.code,{children:\"icc -O3 -xhost\"}),\" \\u7684\\u7F16\\u8BD1\\u6307\\u4EE4\\u65F6\\uFF0C\\u8FD0\\u884C 100m \\u6B21\\uFF0C\\u76F8\\u8F83\\u4E8E \",(0,e.jsx)(n.code,{children:\"g++ -O3\"}),\"\\uFF0C\\u5411\\u91CF\\u5316\\u7684\\u7F16\\u8BD1\\u65B9\\u5F0F\\u80FD\\u591F\\u83B7\\u5F97 2 \\u500D\\u5DE6\\u53F3\\u7684\\u901F\\u5EA6\\u63D0\\u5347\\u3002\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u89C2\\u5BDF\\u8F93\\u51FA\\u6587\\u4EF6\\u7684\\u6C47\\u7F16\\u4EE3\\u7801\\uFF0C\\u53EF\\u4EE5\\u770B\\u5230\\u5411\\u91CF\\u5316\\u6307\\u4EE4\\u7684\\u4F7F\\u7528\\uFF1A\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"language-asm code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`402ee0:       c4 81 7c 10 14 88       vmovups (%r8,%r9,4),%ymm2\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`402ee6:       c4 81 7c 10 64 88 20    vmovups 0x20(%r8,%r9,4),%ymm4\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`402eed:       c5 fc 57 c0             vxorps %ymm0,%ymm0,%ymm0\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`402ef1:       62 f1 7d 08 74 c8       vpcmpeqb %xmm0,%xmm0,%k1\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`402ef7:       c5 f4 57 c9             vxorps %ymm1,%ymm1,%ymm1\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`402efb:       62 f2 7d 29 92 04 97    vgatherdps (%rdi,%ymm2,4),%ymm0\n`})]})}),`\n`,(0,e.jsxs)(n.h3,{id:\"\\u624B\\u52A8\\u5411\\u91CF\\u5316\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u624B\\u52A8\\u5411\\u91CF\\u5316\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u624B\\u52A8\\u5411\\u91CF\\u5316\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u4E0B\\u9762\\u662F\\u76F8\\u540C\\u4EE3\\u7801\\u7684\\u624B\\u52A8\\u5411\\u91CF\\u5316\\u5B9E\\u73B0\\uFF1A\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-cpp\",children:(0,e.jsxs)(n.code,{className:\"language-cpp code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"core_intrinsics\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"std\",(0,e.jsx)(n.span,{className:\"token double-colon punctuation\",children:\"::\"}),\"vector\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"float\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"&\"}),\" a\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" std\",(0,e.jsx)(n.span,{className:\"token double-colon punctuation\",children:\"::\"}),\"vector\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"float\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"&\"}),\" b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" idx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"int\"}),\" j \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" j \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1024\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" j \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"16\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        __m512i _idx \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"_mm512_load_epi32\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"idx \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" j\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        __m512 _b512 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"_mm512_load_ps\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"data\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" j\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        __m512 _a512 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"_mm512_i32gather_ps\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"_idx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" a\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"data\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        __m512 _res \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"_mm512_add_ps\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"_a512\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" _b512\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token function\",children:\"_mm512_i32scatter_ps\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"a\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"data\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" _idx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" _res\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u6709\\u5174\\u8DA3\\u7684\\u53EF\\u4EE5\\u81EA\\u5DF1\\u5C1D\\u8BD5\\uFF0C\\u6BD4\\u8F83\\u4E24\\u79CD\\u65B9\\u6CD5\\u7684\\u901F\\u5EA6\\u4EE5\\u53CA\\u80CC\\u540E\\u7684\\u539F\\u56E0\\u3002\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"\\u7ED3\\u8BBA\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u7ED3\\u8BBA\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u7ED3\\u8BBA\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u901A\\u8FC7\\u4E0A\\u9762\\u7684\\u7B80\\u5355\\u5B9E\\u9A8C\\uFF0C\\u6211\\u4EEC\\u521D\\u6B65\\u8BA4\\u77E5\\u4E86\\u5411\\u91CF\\u5316\\u7684\\u4E24\\u79CD\\u5B9E\\u73B0\\u65B9\\u5F0F\\u3002\\u4F46\\u662F\\u5982\\u4F55\\u80FD\\u66F4\\u597D\\u5730\\u5229\\u7528 AVX \\u6307\\u4EE4\\u7684\\u4F18\\u52BF\\uFF0C\\u9700\\u8981\\u8003\\u8651\\u5177\\u4F53\\u7684\\u4EE3\\u7801\\u3002\\u5F71\\u54CD\\u6027\\u80FD\\u7684\\u6838\\u5FC3\\u56E0\\u7D20\\u662F memory bound \\u8FD8\\u662F compute bound\\uFF0C\\u4EE3\\u7801\\u7A0B\\u5E8F\\u662F\\u5426\\u80FD\\u5B9E\\u73B0\\u6307\\u4EE4\\u4E0A\\u7684\\u5E76\\u884C\\uFF0C\\u4EE3\\u7801\\u7684\\u5173\\u952E\\u8DEF\\u5F84\\u662F\\u4EC0\\u4E48\\u7B49\\u7B49\\u90FD\\u662F\\u6211\\u4EEC\\u9700\\u8981\\u8003\\u8651\\u7684\\u3002\"})]})}function p(a={}){let{wrapper:n}=a.components||{};return n?(0,e.jsx)(n,{...a,children:(0,e.jsx)(d,{...a})}):d(a)}return g(b);})();\n;return Component;"
  },
  "_id": "blog/avx-intro.mdx",
  "_raw": {
    "sourceFilePath": "blog/avx-intro.mdx",
    "sourceFileName": "avx-intro.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/avx-intro"
  },
  "type": "Blog",
  "readingTime": {
    "text": "4 min read",
    "minutes": 3.38,
    "time": 202800,
    "words": 676
  },
  "slug": "avx-intro",
  "path": "blog/avx-intro",
  "toc": [
    {
      "value": "简介",
      "url": "#简介",
      "depth": 2
    },
    {
      "value": "实现",
      "url": "#实现",
      "depth": 2
    },
    {
      "value": "自动向量化",
      "url": "#自动向量化",
      "depth": 3
    },
    {
      "value": "手动向量化",
      "url": "#手动向量化",
      "depth": 3
    },
    {
      "value": "结论",
      "url": "#结论",
      "depth": 2
    }
  ],
  "structuredData": {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "AVX 指令入门",
    "datePublished": "2022-11-19T00:00:00.000Z",
    "dateModified": "2022-11-19T00:00:00.000Z",
    "description": "介绍 SIMD 向量化指令的基础概念，包括自动向量化与手动向量化的实现方式和性能对比。",
    "url": "https://zhangjian94cn.github.io/blog/avx-intro"
  }
}