{
  "title": "Let's build GPT: from scratch, in code, spelled out (1)",
  "date": "2023-01-20T00:00:00.000Z",
  "tags": [
    "LLM",
    "GPT"
  ],
  "draft": false,
  "summary": "a shocking turn of events a leaf has fallen from a treat in the local park Witnesses report that the leaf which was previously attached to a branch of",
  "authors": [
    "default"
  ],
  "body": {
    "raw": "\n最近Karpathy写的这篇关于gpt的教程通俗易懂，引起了非常大的反响。这里，我参考了这篇教程进行了简单翻译、总结。\n\n## 简介\n\n### ChatGPT, Transformers, nanoGPT, Shakespeare\n\nChatGPT是一个革命性的语言模型，在人工智能界引起了轰动，它是一个基于文本让你和AI互动的系统。例如，可以要求ChatGPT给我们写一首俳句，说明人们了解AI的重要性以及如何利用它来改善世界并使其更加繁荣。ChatGPT是一个概率性系统，因此对于任何一个提示（prompt），它都可以给出多个答案。\n\n一个例子，请写一篇关于树叶从树上掉下来的突发新闻：\n\n> a shocking turn of events a leaf has fallen from a treat in the local park Witnesses report that the leaf which was previously attached to a branch of a tree detached itself and fell to the ground very dramatic\n\n你可以看到，这是一个相当了不起的系统，它模拟了单词，字符或标记的序列，它知道英语中的单词是如何相互关联的。给它一个序列的开头，ChatGPT完成了序列，在这个意义上它是一个语言模型。\n\n\n\n接下来，我们将研究ChatGPT背后的技术原理。那么，在背后模拟单词序列的神经网络是什么呢？其来自于一篇名为[《Attention Is All You Need》](https://proceedings.neurips.cc/paper/2017/file/3f5ee243547dee91fbd053c1c4a845aa-Paper.pdf)的论文，发表于2017年。这是一篇具有里程碑意义的论文，提出了Transformer架构。GPT是通用预训练Transformer的缩写（[Generative Pre-Training](https://s3-us-west-2.amazonaws.com/openai-assets/research-covers/language-unsupervised/language_understanding_paper.pdf)）。在2017年的这篇论文中，Transformer架构是为机器翻译而设计的，但实际上它在人工智能领域取得了巨大成功，成为了许多应用的核心技术，包括ChatGPT。\n\n现在，让我们来建立一个类似于ChatGPT的系统（我们无法直接复现ChatGPT，这是一个非常严肃的生产级系统，它在大量的互联网上训练过，并经过了大量的预训练和微调，因此非常复杂）。我们重点关注的是：**如何训练一个基于Transformer的语言模型**。在这里，我们将实现一个**字符级的语言模型**。这非常的有教育意义，它可以帮助我们了解这些系统的工作原理，同时也不需要训练整个互联网，只需要一个较小的数据集。我们使用了一个小数据集，名为Tiny Shakespeare。它是所有莎士比亚作品的结合体，整个文件大约1MB。我们将使用这个数据集来训练Transformer，让它能够产生类似于莎士比亚作品的字符序列。\n\n在训练完成后，我们可以生成无限量的莎士比亚作品，虽然它是假的，但看起来很像莎士比亚的作品。这是通过Transformer实现的，它的工作方式类似于ChatGPT，不同的是它是逐个字符进行预测的，而ChatGPT是**逐个词**级别的。Karpathy已经写好了训练这些Transformer的所有代码，并且可以在的GitHub上找到名为Nano GPT的repo。这是一个很好的学习资源，可以帮助你了解如何训练这种类型的模型。\n\n## 代码\n\n现在我们从零开始构建Transformer模型。我们将在Tiny Shakespeare数据集上进行训练，并看看如何生成无限的莎士比亚作品。重要的是：这个过程可以应用于任意的文本数据集。你需要掌握Python编程，并对微积分和统计学有基本的了解。[google colab](https://colab.research.google.com/drive/1JMLa53HDuA-i7ZBmqV7ZnA3c_fvtXnx-?usp=sharing#scrollTo=wJpXpmjEYC_T)\n\n### baseline language modeling, code setup\n\n#### reading and exploring the data\n\n首先下载数据集：\n\n```bash\n# We always start with a dataset to train on. Let's download the tiny shakespeare dataset\n!wget https://raw.githubusercontent.com/karpathy/char-rnn/master/data/tinyshakespeare/input.txt\n```\n\n读取数据，并查看\n```python\n# read it in to inspect it\nwith open('input.txt', 'r', encoding='utf-8') as f:\n    text = f.read()\n\nprint(\"length of dataset in characters: \", len(text))\n\n# let's look at the first 1000 characters\nprint(text[:1000])\n```\n\n提取本文中的所有字符\n```python\n# here are all the unique characters that occur in this text\nchars = sorted(list(set(text)))\nvocab_size = len(chars)\nprint(''.join(chars))\nprint(vocab_size)\n```\n\n输出\n```bash\n!$&',-.3:;?ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\n65\n```\n\n#### tokenization, train/val split\n\n将原始的文本转化为整数序列的过程，称为tokenization。这里实现了一种简单的基于字符的tokenization：遍历所有的字符，并建立一个字符到整数的映射表和反向映射表（encoder和decoder）。这样就可以将任意字符串编码为整数序列，也可以将其解码回原来的字符串。除此以外，也可以使用[google/sentencepiece](https://github.com/google/sentencepiece)，[openai/tiktoken](https://github.com/openai/tiktoken)...\n\n\n```python\n# create a mapping from characters to integers\nstoi = { ch:i for i,ch in enumerate(chars) }\nitos = { i:ch for i,ch in enumerate(chars) }\nencode = lambda s: [stoi[c] for c in s] # encoder: take a string, output a list of integers\ndecode = lambda l: ''.join([itos[i] for i in l]) # decoder: take a list of integers, output a string\n\nprint(encode(\"hii there\"))\nprint(decode(encode(\"hii there\")))\n```\n\n在下面这段代码中，我们使用tensor存储数据，并且划分训练集与测试集\n```python\n# let's now encode the entire text dataset and store it into a torch.Tensor\nimport torch # we use PyTorch: https://pytorch.org\ndata = torch.tensor(encode(text), dtype=torch.long)\nprint(data.shape, data.dtype)\nprint(data[:1000]) # the 1000 characters we looked at earier will to the GPT look like this\n\n# Let's now split up the data into train and validation sets\nn = int(0.9*len(data)) # first 90% will be train, rest val\ntrain_data = data[:n]\nval_data = data[n:]\n```\n\n#### data loader: batches of chunks of data\n\n由于我们不可能一次性将文本全部输入到Transformer中，这样计算代价太高。因此，当我们在大量数据集上训练Transformer时，只使用数据集的小块。这些小块都有一定长度，最大长度是block size。在这里，我们设置block size的值为8。因此，最小的训练单元包含9位数据，前8位是模型输入$x$，后8位则是标签值$y$\n\n```python\nblock_size = 8\ntrain_data[:block_size+1]\n```\n\n在这9位数据中，可以获得8个训练单元，我们将这8个训练单元打印出来\n\n```python\nx = train_data[:block_size]\ny = train_data[1:block_size+1]\nfor t in range(block_size):\n    context = x[:t+1]\n    target = y[t]\n    print(f\"when input is {context} the target: {target}\")\n```\n\n打印结果如下：\n\n```bash\nwhen input is tensor([18]) the target: 47\nwhen input is tensor([18, 47]) the target: 56\nwhen input is tensor([18, 47, 56]) the target: 57\nwhen input is tensor([18, 47, 56, 57]) the target: 58\nwhen input is tensor([18, 47, 56, 57, 58]) the target: 1\nwhen input is tensor([18, 47, 56, 57, 58,  1]) the target: 15\nwhen input is tensor([18, 47, 56, 57, 58,  1, 15]) the target: 47\nwhen input is tensor([18, 47, 56, 57, 58,  1, 15, 47]) the target: 58\n```\n\n使用存在长度限制的$(input, target)$来训练transformer，既可以提升效率，也能让transformer在推理时适应不同的文字输入长度，甚至可以只使用1个字符作为输入进行预测。 我们还会设置batch size，这样可以同时处理多个数据。而batch的获取， 会随机的从训练数据中进行采样。\n\n\n```python\ntorch.manual_seed(1337)\nbatch_size = 4 # how many independent sequences will we process in parallel?\nblock_size = 8 # what is the maximum context length for predictions?\n\ndef get_batch(split):\n    # generate a small batch of data of inputs x and targets y\n    data = train_data if split == 'train' else val_data\n    ix = torch.randint(len(data) - block_size, (batch_size,))\n    x = torch.stack([data[i:i+block_size] for i in ix])\n    y = torch.stack([data[i+1:i+block_size+1] for i in ix])\n    return x, y\n```\n\n我们可以将采样得到的数据打印出来\n\n```python\nxb, yb = get_batch('train')\nprint('inputs:')\nprint(xb.shape)\nprint(xb)\nprint('targets:')\nprint(yb.shape)\nprint(yb)\n\nprint('----')\n\nfor b in range(batch_size): # batch dimension\n    for t in range(block_size): # time dimension\n        context = xb[b, :t+1]\n        target = yb[b,t]\n        print(f\"when input is {context.tolist()} the target: {target}\")\n```\n\n打印结果：\n\n```\ninputs:\ntorch.Size([4, 8])\ntensor([[24, 43, 58,  5, 57,  1, 46, 43],\n        [44, 53, 56,  1, 58, 46, 39, 58],\n        [52, 58,  1, 58, 46, 39, 58,  1],\n        [25, 17, 27, 10,  0, 21,  1, 54]])\ntargets:\ntorch.Size([4, 8])\ntensor([[43, 58,  5, 57,  1, 46, 43, 39],\n        [53, 56,  1, 58, 46, 39, 58,  1],\n        [58,  1, 58, 46, 39, 58,  1, 46],\n        [17, 27, 10,  0, 21,  1, 54, 39]])\n----\nwhen input is [24] the target: 43\nwhen input is [24, 43] the target: 58\n···\n```\n\n#### simplest baseline: bigram language model, loss, generation\n\n让我们从一个最简单的神经网络语言模型开始，即*bigram language model*。在`__init__`中，我们使用nn.Embedding定义了token_embedding_table，其是一个大小为vocab_size*vocab_size的矩阵，当输入一个字符的idx：`self.token_embedding_table(idx)`，便会从这个矩阵中得到对应的一行向量，例如我们输入24，就会得到第24行的数据。\n\n在训练过程中，forward函数中的`idx`，其形状是`batch_size*time`，经过embedding，我们会得到形状为`batch_size*time*channel`的张量logits，其为网络输出的原始预测值，是未经过归一化的。继续看forward函数，当存在targets（为训练过程）时，首先将logits、targets进行reshape，再使用交叉熵函数计算loss。\n\n在训练完成后，可以使用训练好的模型生成连续的字符，也就是函数`generate`所做的事。首先，最大的字符生成长度为`max_new_tokens`，循环开始，向forward函数中输入当前的idx，得到logits，取时间维度上的最后一维（字符串的最后一个字符），经过softmax归一化得到概率，再根据概率得到下一个字符的idx，最后将当前的预测结果idx_next与之前的idx进行合并，这样便可以得到当前的最新字符序列。\n\n```python\nimport torch\nimport torch.nn as nn\nfrom torch.nn import functional as F\ntorch.manual_seed(1337)\n\nclass BigramLanguageModel(nn.Module):\n\n    def __init__(self, vocab_size):\n        super().__init__()\n        # each token directly reads off the logits for the next token from a lookup table\n        self.token_embedding_table = nn.Embedding(vocab_size, vocab_size)\n\n    def forward(self, idx, targets=None):\n\n        # idx and targets are both (B,T) tensor of integers\n        logits = self.token_embedding_table(idx) # (B,T,C)\n        \n        if targets is None:\n            loss = None\n        else:\n            B, T, C = logits.shape\n            logits = logits.view(B*T, C)\n            targets = targets.view(B*T)\n            loss = F.cross_entropy(logits, targets)\n\n        return logits, loss\n    \n    def generate(self, idx, max_new_tokens):\n        # idx is (B, T) array of indices in the current context\n        for _ in range(max_new_tokens):\n            # get the predictions\n            logits, loss = self(idx)\n            # focus only on the last time step\n            logits = logits[:, -1, :] # becomes (B, C)\n            # apply softmax to get probabilities\n            probs = F.softmax(logits, dim=-1) # (B, C)\n            # sample from the distribution\n            idx_next = torch.multinomial(probs, num_samples=1) # (B, 1)\n            # append sampled index to the running sequence\n            idx = torch.cat((idx, idx_next), dim=1) # (B, T+1)\n        return idx\n\n```\n\n基于这个模型，我们可以生成一个长度为100的字符串序列\n\n```python\nm = BigramLanguageModel(vocab_size)\nlogits, loss = m(xb, yb)\nprint(logits.shape)\nprint(loss)\n\nprint(decode(m.generate(idx = torch.zeros((1, 1), dtype=torch.long), max_new_tokens=100)[0].tolist()))\n```\n打印结果如下：\n\n```\ntorch.Size([32, 65])\ntensor(4.8786, grad_fn=<NllLossBackward0>)\n\nSKIcLT;AcELMoTbvZv C?nq-QE33:CJqkOKH-q;:la!oiywkHjgChzbQ?u!3bLIgwevmyFJGUGp\nwnYWmnxKWWev-tDqXErVKLgJ\n```\n\n#### training the bigram model\n\n接下来，让我们开始训练模型，首先加入AdamW优化器，然后设置100次循环迭代，一次循环的步骤如下：\n1. 获取batch数据\n2. 模型预测得到loss\n3. 清空优化器之前的梯度信息\n4. loss反传得到梯度\n5. optimizer基于梯度信息更新模型参数\n\n```python\n# create a PyTorch optimizer\noptimizer = torch.optim.AdamW(m.parameters(), lr=1e-3)\n\nbatch_size = 32\nfor steps in range(100): # increase number of steps for good results... \n    \n    # sample a batch of data\n    xb, yb = get_batch('train')\n\n    # evaluate the loss\n    logits, loss = m(xb, yb)\n    optimizer.zero_grad(set_to_none=True)\n    loss.backward()\n    optimizer.step()\n\nprint(loss.item())\n```\n\n最终这个模型的训练效果并不好，迭代100次之后，loss为4.66，打印预测的字符序列：\n\n```python\nprint(decode(m.generate(idx = torch.zeros((1, 1), dtype=torch.long), max_new_tokens=500)[0].tolist()))\n```\n\n打印结果：\n\n```\noTo.JUZ!!zqe!\nxBP qbs$Gy'AcOmrLwwt\np$x;Seh-onQbfM?OjKbn'NwUAW -Np3fkz$FVwAUEa-wzWC -wQo-R!v -Mj?,SPiTyZ;o-opr$mOiPJEYD-CfigkzD3p3?zvS;ADz;.y?o,ivCuC'zqHxcVT cHA\nrT'Fd,SBMZyOslg!NXeF$sBe,juUzLq?w-wzP-h\nERjjxlgJzPbHxf$ q,q,KCDCU fqBOQT\nSV&CW:xSVwZv'DG'NSPypDhKStKzC -$hslxIVzoivnp ,ethA:NCCGoi\ntN!ljjP3fwJMwNelgUzzPGJlgihJ!d?q.d\npSPYgCuCJrIFtb\njQXg\npA.P LP,SPJi\nDBcuBM:CixjJ$Jzkq,OLf3KLQLMGph$O 3DfiPHnXKuHMlyjxEiyZib3FaHV-oJa!zoc'XSP :CKGUhd?lgCOF$;;DTHZMlvvcmZAm;:iv'MMgO&Ywbc;BLCUd&vZINLIzkuTGZa\nD.?\n```\n\n## 结论\n\n至此，我们搭建了一个最简单的语言模型，虽然目前的结果并不好，但是接下来的文章中，我们将引入self attention以及transformer，这将大大提升模型的效果，敬请期待:)\n\n## 参考\n\n[video](https://www.youtube.com/watch?v=kCc8FmEb1nY&list=PLAqhIrjkxbuWI23v9cThsA9GvCAUhRvKZ&index=8)，[Google colab ](https://colab.research.google.com/drive/1JMLa53HDuA-i7ZBmqV7ZnA3c_fvtXnx-?usp=sharing)，[karpathy/nanoGPT](https://github.com/karpathy/nanoGPT)，[karpathy/ng-video-lecture](https://github.com/karpathy/ng-video-lecture)\n\n\n\n\n\n\n\n",
    "code": "var Component=(()=>{var m=Object.create;var l=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var b=(a,n)=>()=>(n||a((n={exports:{}}).exports,n),n.exports),g=(a,n)=>{for(var s in n)l(a,s,{get:n[s],enumerable:!0})},i=(a,n,s,t)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let c of u(n))!k.call(a,c)&&c!==s&&l(a,c,{get:()=>n[c],enumerable:!(t=h(n,c))||t.enumerable});return a};var y=(a,n,s)=>(s=a!=null?m(N(a)):{},i(n||!a||!a.__esModule?l(s,\"default\",{value:a,enumerable:!0}):s,a)),w=a=>i(l({},\"__esModule\",{value:!0}),a);var r=b((z,o)=>{o.exports=_jsx_runtime});var x={};g(x,{default:()=>d,frontmatter:()=>f});var e=y(r()),f={title:\"Let's build GPT: from scratch, in code, spelled out (1)\",date:\"2023-01-20\",tags:[\"LLM\",\"GPT\"],draft:!1,summary:\"a shocking turn of events a leaf has fallen from a treat in the local park Witnesses report that the leaf which was previously attached to a branch of\",authors:[\"default\"]};function p(a){let n={a:\"a\",annotation:\"annotation\",blockquote:\"blockquote\",code:\"code\",em:\"em\",h2:\"h2\",h3:\"h3\",h4:\"h4\",li:\"li\",math:\"math\",mi:\"mi\",mo:\"mo\",mrow:\"mrow\",ol:\"ol\",p:\"p\",pre:\"pre\",semantics:\"semantics\",span:\"span\",strong:\"strong\",...a.components};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"\\u6700\\u8FD1Karpathy\\u5199\\u7684\\u8FD9\\u7BC7\\u5173\\u4E8Egpt\\u7684\\u6559\\u7A0B\\u901A\\u4FD7\\u6613\\u61C2\\uFF0C\\u5F15\\u8D77\\u4E86\\u975E\\u5E38\\u5927\\u7684\\u53CD\\u54CD\\u3002\\u8FD9\\u91CC\\uFF0C\\u6211\\u53C2\\u8003\\u4E86\\u8FD9\\u7BC7\\u6559\\u7A0B\\u8FDB\\u884C\\u4E86\\u7B80\\u5355\\u7FFB\\u8BD1\\u3001\\u603B\\u7ED3\\u3002\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"\\u7B80\\u4ECB\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u7B80\\u4ECB\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u7B80\\u4ECB\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"chatgpt-transformers-nanogpt-shakespeare\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#chatgpt-transformers-nanogpt-shakespeare\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"ChatGPT, Transformers, nanoGPT, Shakespeare\"]}),`\n`,(0,e.jsx)(n.p,{children:\"ChatGPT\\u662F\\u4E00\\u4E2A\\u9769\\u547D\\u6027\\u7684\\u8BED\\u8A00\\u6A21\\u578B\\uFF0C\\u5728\\u4EBA\\u5DE5\\u667A\\u80FD\\u754C\\u5F15\\u8D77\\u4E86\\u8F70\\u52A8\\uFF0C\\u5B83\\u662F\\u4E00\\u4E2A\\u57FA\\u4E8E\\u6587\\u672C\\u8BA9\\u4F60\\u548CAI\\u4E92\\u52A8\\u7684\\u7CFB\\u7EDF\\u3002\\u4F8B\\u5982\\uFF0C\\u53EF\\u4EE5\\u8981\\u6C42ChatGPT\\u7ED9\\u6211\\u4EEC\\u5199\\u4E00\\u9996\\u4FF3\\u53E5\\uFF0C\\u8BF4\\u660E\\u4EBA\\u4EEC\\u4E86\\u89E3AI\\u7684\\u91CD\\u8981\\u6027\\u4EE5\\u53CA\\u5982\\u4F55\\u5229\\u7528\\u5B83\\u6765\\u6539\\u5584\\u4E16\\u754C\\u5E76\\u4F7F\\u5176\\u66F4\\u52A0\\u7E41\\u8363\\u3002ChatGPT\\u662F\\u4E00\\u4E2A\\u6982\\u7387\\u6027\\u7CFB\\u7EDF\\uFF0C\\u56E0\\u6B64\\u5BF9\\u4E8E\\u4EFB\\u4F55\\u4E00\\u4E2A\\u63D0\\u793A\\uFF08prompt\\uFF09\\uFF0C\\u5B83\\u90FD\\u53EF\\u4EE5\\u7ED9\\u51FA\\u591A\\u4E2A\\u7B54\\u6848\\u3002\"}),`\n`,(0,e.jsx)(n.p,{children:\"\\u4E00\\u4E2A\\u4F8B\\u5B50\\uFF0C\\u8BF7\\u5199\\u4E00\\u7BC7\\u5173\\u4E8E\\u6811\\u53F6\\u4ECE\\u6811\\u4E0A\\u6389\\u4E0B\\u6765\\u7684\\u7A81\\u53D1\\u65B0\\u95FB\\uFF1A\"}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:\"a shocking turn of events a leaf has fallen from a treat in the local park Witnesses report that the leaf which was previously attached to a branch of a tree detached itself and fell to the ground very dramatic\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u4F60\\u53EF\\u4EE5\\u770B\\u5230\\uFF0C\\u8FD9\\u662F\\u4E00\\u4E2A\\u76F8\\u5F53\\u4E86\\u4E0D\\u8D77\\u7684\\u7CFB\\u7EDF\\uFF0C\\u5B83\\u6A21\\u62DF\\u4E86\\u5355\\u8BCD\\uFF0C\\u5B57\\u7B26\\u6216\\u6807\\u8BB0\\u7684\\u5E8F\\u5217\\uFF0C\\u5B83\\u77E5\\u9053\\u82F1\\u8BED\\u4E2D\\u7684\\u5355\\u8BCD\\u662F\\u5982\\u4F55\\u76F8\\u4E92\\u5173\\u8054\\u7684\\u3002\\u7ED9\\u5B83\\u4E00\\u4E2A\\u5E8F\\u5217\\u7684\\u5F00\\u5934\\uFF0CChatGPT\\u5B8C\\u6210\\u4E86\\u5E8F\\u5217\\uFF0C\\u5728\\u8FD9\\u4E2A\\u610F\\u4E49\\u4E0A\\u5B83\\u662F\\u4E00\\u4E2A\\u8BED\\u8A00\\u6A21\\u578B\\u3002\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u63A5\\u4E0B\\u6765\\uFF0C\\u6211\\u4EEC\\u5C06\\u7814\\u7A76ChatGPT\\u80CC\\u540E\\u7684\\u6280\\u672F\\u539F\\u7406\\u3002\\u90A3\\u4E48\\uFF0C\\u5728\\u80CC\\u540E\\u6A21\\u62DF\\u5355\\u8BCD\\u5E8F\\u5217\\u7684\\u795E\\u7ECF\\u7F51\\u7EDC\\u662F\\u4EC0\\u4E48\\u5462\\uFF1F\\u5176\\u6765\\u81EA\\u4E8E\\u4E00\\u7BC7\\u540D\\u4E3A\",(0,e.jsx)(n.a,{href:\"https://proceedings.neurips.cc/paper/2017/file/3f5ee243547dee91fbd053c1c4a845aa-Paper.pdf\",children:\"\\u300AAttention Is All You Need\\u300B\"}),\"\\u7684\\u8BBA\\u6587\\uFF0C\\u53D1\\u8868\\u4E8E2017\\u5E74\\u3002\\u8FD9\\u662F\\u4E00\\u7BC7\\u5177\\u6709\\u91CC\\u7A0B\\u7891\\u610F\\u4E49\\u7684\\u8BBA\\u6587\\uFF0C\\u63D0\\u51FA\\u4E86Transformer\\u67B6\\u6784\\u3002GPT\\u662F\\u901A\\u7528\\u9884\\u8BAD\\u7EC3Transformer\\u7684\\u7F29\\u5199\\uFF08\",(0,e.jsx)(n.a,{href:\"https://s3-us-west-2.amazonaws.com/openai-assets/research-covers/language-unsupervised/language_understanding_paper.pdf\",children:\"Generative Pre-Training\"}),\"\\uFF09\\u3002\\u57282017\\u5E74\\u7684\\u8FD9\\u7BC7\\u8BBA\\u6587\\u4E2D\\uFF0CTransformer\\u67B6\\u6784\\u662F\\u4E3A\\u673A\\u5668\\u7FFB\\u8BD1\\u800C\\u8BBE\\u8BA1\\u7684\\uFF0C\\u4F46\\u5B9E\\u9645\\u4E0A\\u5B83\\u5728\\u4EBA\\u5DE5\\u667A\\u80FD\\u9886\\u57DF\\u53D6\\u5F97\\u4E86\\u5DE8\\u5927\\u6210\\u529F\\uFF0C\\u6210\\u4E3A\\u4E86\\u8BB8\\u591A\\u5E94\\u7528\\u7684\\u6838\\u5FC3\\u6280\\u672F\\uFF0C\\u5305\\u62ECChatGPT\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u73B0\\u5728\\uFF0C\\u8BA9\\u6211\\u4EEC\\u6765\\u5EFA\\u7ACB\\u4E00\\u4E2A\\u7C7B\\u4F3C\\u4E8EChatGPT\\u7684\\u7CFB\\u7EDF\\uFF08\\u6211\\u4EEC\\u65E0\\u6CD5\\u76F4\\u63A5\\u590D\\u73B0ChatGPT\\uFF0C\\u8FD9\\u662F\\u4E00\\u4E2A\\u975E\\u5E38\\u4E25\\u8083\\u7684\\u751F\\u4EA7\\u7EA7\\u7CFB\\u7EDF\\uFF0C\\u5B83\\u5728\\u5927\\u91CF\\u7684\\u4E92\\u8054\\u7F51\\u4E0A\\u8BAD\\u7EC3\\u8FC7\\uFF0C\\u5E76\\u7ECF\\u8FC7\\u4E86\\u5927\\u91CF\\u7684\\u9884\\u8BAD\\u7EC3\\u548C\\u5FAE\\u8C03\\uFF0C\\u56E0\\u6B64\\u975E\\u5E38\\u590D\\u6742\\uFF09\\u3002\\u6211\\u4EEC\\u91CD\\u70B9\\u5173\\u6CE8\\u7684\\u662F\\uFF1A\",(0,e.jsx)(n.strong,{children:\"\\u5982\\u4F55\\u8BAD\\u7EC3\\u4E00\\u4E2A\\u57FA\\u4E8ETransformer\\u7684\\u8BED\\u8A00\\u6A21\\u578B\"}),\"\\u3002\\u5728\\u8FD9\\u91CC\\uFF0C\\u6211\\u4EEC\\u5C06\\u5B9E\\u73B0\\u4E00\\u4E2A\",(0,e.jsx)(n.strong,{children:\"\\u5B57\\u7B26\\u7EA7\\u7684\\u8BED\\u8A00\\u6A21\\u578B\"}),\"\\u3002\\u8FD9\\u975E\\u5E38\\u7684\\u6709\\u6559\\u80B2\\u610F\\u4E49\\uFF0C\\u5B83\\u53EF\\u4EE5\\u5E2E\\u52A9\\u6211\\u4EEC\\u4E86\\u89E3\\u8FD9\\u4E9B\\u7CFB\\u7EDF\\u7684\\u5DE5\\u4F5C\\u539F\\u7406\\uFF0C\\u540C\\u65F6\\u4E5F\\u4E0D\\u9700\\u8981\\u8BAD\\u7EC3\\u6574\\u4E2A\\u4E92\\u8054\\u7F51\\uFF0C\\u53EA\\u9700\\u8981\\u4E00\\u4E2A\\u8F83\\u5C0F\\u7684\\u6570\\u636E\\u96C6\\u3002\\u6211\\u4EEC\\u4F7F\\u7528\\u4E86\\u4E00\\u4E2A\\u5C0F\\u6570\\u636E\\u96C6\\uFF0C\\u540D\\u4E3ATiny Shakespeare\\u3002\\u5B83\\u662F\\u6240\\u6709\\u838E\\u58EB\\u6BD4\\u4E9A\\u4F5C\\u54C1\\u7684\\u7ED3\\u5408\\u4F53\\uFF0C\\u6574\\u4E2A\\u6587\\u4EF6\\u5927\\u7EA61MB\\u3002\\u6211\\u4EEC\\u5C06\\u4F7F\\u7528\\u8FD9\\u4E2A\\u6570\\u636E\\u96C6\\u6765\\u8BAD\\u7EC3Transformer\\uFF0C\\u8BA9\\u5B83\\u80FD\\u591F\\u4EA7\\u751F\\u7C7B\\u4F3C\\u4E8E\\u838E\\u58EB\\u6BD4\\u4E9A\\u4F5C\\u54C1\\u7684\\u5B57\\u7B26\\u5E8F\\u5217\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u5728\\u8BAD\\u7EC3\\u5B8C\\u6210\\u540E\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u751F\\u6210\\u65E0\\u9650\\u91CF\\u7684\\u838E\\u58EB\\u6BD4\\u4E9A\\u4F5C\\u54C1\\uFF0C\\u867D\\u7136\\u5B83\\u662F\\u5047\\u7684\\uFF0C\\u4F46\\u770B\\u8D77\\u6765\\u5F88\\u50CF\\u838E\\u58EB\\u6BD4\\u4E9A\\u7684\\u4F5C\\u54C1\\u3002\\u8FD9\\u662F\\u901A\\u8FC7Transformer\\u5B9E\\u73B0\\u7684\\uFF0C\\u5B83\\u7684\\u5DE5\\u4F5C\\u65B9\\u5F0F\\u7C7B\\u4F3C\\u4E8EChatGPT\\uFF0C\\u4E0D\\u540C\\u7684\\u662F\\u5B83\\u662F\\u9010\\u4E2A\\u5B57\\u7B26\\u8FDB\\u884C\\u9884\\u6D4B\\u7684\\uFF0C\\u800CChatGPT\\u662F\",(0,e.jsx)(n.strong,{children:\"\\u9010\\u4E2A\\u8BCD\"}),\"\\u7EA7\\u522B\\u7684\\u3002Karpathy\\u5DF2\\u7ECF\\u5199\\u597D\\u4E86\\u8BAD\\u7EC3\\u8FD9\\u4E9BTransformer\\u7684\\u6240\\u6709\\u4EE3\\u7801\\uFF0C\\u5E76\\u4E14\\u53EF\\u4EE5\\u5728\\u7684GitHub\\u4E0A\\u627E\\u5230\\u540D\\u4E3ANano GPT\\u7684repo\\u3002\\u8FD9\\u662F\\u4E00\\u4E2A\\u5F88\\u597D\\u7684\\u5B66\\u4E60\\u8D44\\u6E90\\uFF0C\\u53EF\\u4EE5\\u5E2E\\u52A9\\u4F60\\u4E86\\u89E3\\u5982\\u4F55\\u8BAD\\u7EC3\\u8FD9\\u79CD\\u7C7B\\u578B\\u7684\\u6A21\\u578B\\u3002\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"\\u4EE3\\u7801\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u4EE3\\u7801\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u4EE3\\u7801\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u73B0\\u5728\\u6211\\u4EEC\\u4ECE\\u96F6\\u5F00\\u59CB\\u6784\\u5EFATransformer\\u6A21\\u578B\\u3002\\u6211\\u4EEC\\u5C06\\u5728Tiny Shakespeare\\u6570\\u636E\\u96C6\\u4E0A\\u8FDB\\u884C\\u8BAD\\u7EC3\\uFF0C\\u5E76\\u770B\\u770B\\u5982\\u4F55\\u751F\\u6210\\u65E0\\u9650\\u7684\\u838E\\u58EB\\u6BD4\\u4E9A\\u4F5C\\u54C1\\u3002\\u91CD\\u8981\\u7684\\u662F\\uFF1A\\u8FD9\\u4E2A\\u8FC7\\u7A0B\\u53EF\\u4EE5\\u5E94\\u7528\\u4E8E\\u4EFB\\u610F\\u7684\\u6587\\u672C\\u6570\\u636E\\u96C6\\u3002\\u4F60\\u9700\\u8981\\u638C\\u63E1Python\\u7F16\\u7A0B\\uFF0C\\u5E76\\u5BF9\\u5FAE\\u79EF\\u5206\\u548C\\u7EDF\\u8BA1\\u5B66\\u6709\\u57FA\\u672C\\u7684\\u4E86\\u89E3\\u3002\",(0,e.jsx)(n.a,{href:\"https://colab.research.google.com/drive/1JMLa53HDuA-i7ZBmqV7ZnA3c_fvtXnx-?usp=sharing#scrollTo=wJpXpmjEYC_T\",children:\"google colab\"})]}),`\n`,(0,e.jsxs)(n.h3,{id:\"baseline-language-modeling-code-setup\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#baseline-language-modeling-code-setup\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"baseline language modeling, code setup\"]}),`\n`,(0,e.jsxs)(n.h4,{id:\"reading-and-exploring-the-data\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#reading-and-exploring-the-data\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"reading and exploring the data\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u9996\\u5148\\u4E0B\\u8F7D\\u6570\\u636E\\u96C6\\uFF1A\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# We always start with a dataset to train on. Let's download the tiny shakespeare dataset\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`wget https://raw.githubusercontent.com/karpathy/char-rnn/master/data/tinyshakespeare/input.txt\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u8BFB\\u53D6\\u6570\\u636E\\uFF0C\\u5E76\\u67E5\\u770B\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# read it in to inspect it\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"with\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"open\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'input.txt'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'r'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" encoding\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'utf-8'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" f\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    text \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" f\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"read\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"length of dataset in characters: \"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"text\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# let's look at the first 1000 characters\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"text\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1000\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u63D0\\u53D6\\u672C\\u6587\\u4E2D\\u7684\\u6240\\u6709\\u5B57\\u7B26\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# here are all the unique characters that occur in this text\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"chars \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"sorted\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"list\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"set\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"text\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"vocab_size \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"chars\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"join\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"chars\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"vocab_size\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u8F93\\u51FA\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"$\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&\"}),\"',-.3:\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`?ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"65\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.h4,{id:\"tokenization-trainval-split\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#tokenization-trainval-split\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"tokenization, train/val split\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u5C06\\u539F\\u59CB\\u7684\\u6587\\u672C\\u8F6C\\u5316\\u4E3A\\u6574\\u6570\\u5E8F\\u5217\\u7684\\u8FC7\\u7A0B\\uFF0C\\u79F0\\u4E3Atokenization\\u3002\\u8FD9\\u91CC\\u5B9E\\u73B0\\u4E86\\u4E00\\u79CD\\u7B80\\u5355\\u7684\\u57FA\\u4E8E\\u5B57\\u7B26\\u7684tokenization\\uFF1A\\u904D\\u5386\\u6240\\u6709\\u7684\\u5B57\\u7B26\\uFF0C\\u5E76\\u5EFA\\u7ACB\\u4E00\\u4E2A\\u5B57\\u7B26\\u5230\\u6574\\u6570\\u7684\\u6620\\u5C04\\u8868\\u548C\\u53CD\\u5411\\u6620\\u5C04\\u8868\\uFF08encoder\\u548Cdecoder\\uFF09\\u3002\\u8FD9\\u6837\\u5C31\\u53EF\\u4EE5\\u5C06\\u4EFB\\u610F\\u5B57\\u7B26\\u4E32\\u7F16\\u7801\\u4E3A\\u6574\\u6570\\u5E8F\\u5217\\uFF0C\\u4E5F\\u53EF\\u4EE5\\u5C06\\u5176\\u89E3\\u7801\\u56DE\\u539F\\u6765\\u7684\\u5B57\\u7B26\\u4E32\\u3002\\u9664\\u6B64\\u4EE5\\u5916\\uFF0C\\u4E5F\\u53EF\\u4EE5\\u4F7F\\u7528\",(0,e.jsx)(n.a,{href:\"https://github.com/google/sentencepiece\",children:\"google/sentencepiece\"}),\"\\uFF0C\",(0,e.jsx)(n.a,{href:\"https://github.com/openai/tiktoken\",children:\"openai/tiktoken\"}),\"...\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# create a mapping from characters to integers\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"stoi \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" ch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"i \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"ch \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"enumerate\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"chars\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"itos \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"ch \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"ch \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"enumerate\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"chars\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"encode \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"lambda\"}),\" s\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"stoi\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"c\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" c \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" s\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# encoder: take a string, output a list of integers\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"decode \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"lambda\"}),\" l\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"join\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"itos\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" l\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# decoder: take a list of integers, output a string\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"encode\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"hii there\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"decode\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"encode\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"hii there\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5728\\u4E0B\\u9762\\u8FD9\\u6BB5\\u4EE3\\u7801\\u4E2D\\uFF0C\\u6211\\u4EEC\\u4F7F\\u7528tensor\\u5B58\\u50A8\\u6570\\u636E\\uFF0C\\u5E76\\u4E14\\u5212\\u5206\\u8BAD\\u7EC3\\u96C6\\u4E0E\\u6D4B\\u8BD5\\u96C6\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# let's now encode the entire text dataset and store it into a torch.Tensor\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" torch \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# we use PyTorch: https://pytorch.org\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"data \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"tensor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"encode\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"text\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" dtype\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"long\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"dtype\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1000\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# the 1000 characters we looked at earier will to the GPT look like this\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Let's now split up the data into train and validation sets\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"n \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"int\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0.9\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# first 90% will be train, rest val\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"train_data \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"n\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"val_data \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"n\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.h4,{id:\"data-loader-batches-of-chunks-of-data\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#data-loader-batches-of-chunks-of-data\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"data loader: batches of chunks of data\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u7531\\u4E8E\\u6211\\u4EEC\\u4E0D\\u53EF\\u80FD\\u4E00\\u6B21\\u6027\\u5C06\\u6587\\u672C\\u5168\\u90E8\\u8F93\\u5165\\u5230Transformer\\u4E2D\\uFF0C\\u8FD9\\u6837\\u8BA1\\u7B97\\u4EE3\\u4EF7\\u592A\\u9AD8\\u3002\\u56E0\\u6B64\\uFF0C\\u5F53\\u6211\\u4EEC\\u5728\\u5927\\u91CF\\u6570\\u636E\\u96C6\\u4E0A\\u8BAD\\u7EC3Transformer\\u65F6\\uFF0C\\u53EA\\u4F7F\\u7528\\u6570\\u636E\\u96C6\\u7684\\u5C0F\\u5757\\u3002\\u8FD9\\u4E9B\\u5C0F\\u5757\\u90FD\\u6709\\u4E00\\u5B9A\\u957F\\u5EA6\\uFF0C\\u6700\\u5927\\u957F\\u5EA6\\u662Fblock size\\u3002\\u5728\\u8FD9\\u91CC\\uFF0C\\u6211\\u4EEC\\u8BBE\\u7F6Eblock size\\u7684\\u503C\\u4E3A8\\u3002\\u56E0\\u6B64\\uFF0C\\u6700\\u5C0F\\u7684\\u8BAD\\u7EC3\\u5355\\u5143\\u5305\\u542B9\\u4F4D\\u6570\\u636E\\uFF0C\\u524D8\\u4F4D\\u662F\\u6A21\\u578B\\u8F93\\u5165\",(0,e.jsxs)(n.span,{className:\"katex\",children:[(0,e.jsx)(n.span,{className:\"katex-mathml\",children:(0,e.jsx)(n.math,{xmlns:\"http://www.w3.org/1998/Math/MathML\",children:(0,e.jsxs)(n.semantics,{children:[(0,e.jsx)(n.mrow,{children:(0,e.jsx)(n.mi,{children:\"x\"})}),(0,e.jsx)(n.annotation,{encoding:\"application/x-tex\",children:\"x\"})]})})}),(0,e.jsx)(n.span,{className:\"katex-html\",\"aria-hidden\":\"true\",children:(0,e.jsxs)(n.span,{className:\"base\",children:[(0,e.jsx)(n.span,{className:\"strut\",style:{height:\"0.4306em\"}}),(0,e.jsx)(n.span,{className:\"mord mathnormal\",children:\"x\"})]})})]}),\"\\uFF0C\\u540E8\\u4F4D\\u5219\\u662F\\u6807\\u7B7E\\u503C\",(0,e.jsxs)(n.span,{className:\"katex\",children:[(0,e.jsx)(n.span,{className:\"katex-mathml\",children:(0,e.jsx)(n.math,{xmlns:\"http://www.w3.org/1998/Math/MathML\",children:(0,e.jsxs)(n.semantics,{children:[(0,e.jsx)(n.mrow,{children:(0,e.jsx)(n.mi,{children:\"y\"})}),(0,e.jsx)(n.annotation,{encoding:\"application/x-tex\",children:\"y\"})]})})}),(0,e.jsx)(n.span,{className:\"katex-html\",\"aria-hidden\":\"true\",children:(0,e.jsxs)(n.span,{className:\"base\",children:[(0,e.jsx)(n.span,{className:\"strut\",style:{height:\"0.625em\",verticalAlign:\"-0.1944em\"}}),(0,e.jsx)(n.span,{className:\"mord mathnormal\",style:{marginRight:\"0.03588em\"},children:\"y\"})]})})]})]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"block_size \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"train_data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"block_size\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5728\\u8FD99\\u4F4D\\u6570\\u636E\\u4E2D\\uFF0C\\u53EF\\u4EE5\\u83B7\\u5F978\\u4E2A\\u8BAD\\u7EC3\\u5355\\u5143\\uFF0C\\u6211\\u4EEC\\u5C06\\u8FD98\\u4E2A\\u8BAD\\u7EC3\\u5355\\u5143\\u6253\\u5370\\u51FA\\u6765\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"x \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" train_data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"block_size\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"y \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" train_data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"block_size\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" t \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"range\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"block_size\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    context \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" x\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"t\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    target \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" y\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"when input is '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"context\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:\" the target: \"}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"target\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u6253\\u5370\\u7ED3\\u679C\\u5982\\u4E0B\\uFF1A\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"when input is tensor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"18\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" the target: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"47\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"when input is tensor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"18\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"47\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" the target: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"56\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"when input is tensor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"18\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"47\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"56\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" the target: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"57\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"when input is tensor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"18\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"47\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"56\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"57\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" the target: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"when input is tensor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"18\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"47\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"56\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"57\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" the target: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"when input is tensor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"18\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"47\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"56\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"57\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),\",  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" the target: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"15\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"when input is tensor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"18\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"47\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"56\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"57\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),\",  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"15\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" the target: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"47\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"when input is tensor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"18\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"47\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"56\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"57\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),\",  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"15\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"47\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" the target: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u4F7F\\u7528\\u5B58\\u5728\\u957F\\u5EA6\\u9650\\u5236\\u7684\",(0,e.jsxs)(n.span,{className:\"katex\",children:[(0,e.jsx)(n.span,{className:\"katex-mathml\",children:(0,e.jsx)(n.math,{xmlns:\"http://www.w3.org/1998/Math/MathML\",children:(0,e.jsxs)(n.semantics,{children:[(0,e.jsxs)(n.mrow,{children:[(0,e.jsx)(n.mo,{stretchy:\"false\",children:\"(\"}),(0,e.jsx)(n.mi,{children:\"i\"}),(0,e.jsx)(n.mi,{children:\"n\"}),(0,e.jsx)(n.mi,{children:\"p\"}),(0,e.jsx)(n.mi,{children:\"u\"}),(0,e.jsx)(n.mi,{children:\"t\"}),(0,e.jsx)(n.mo,{separator:\"true\",children:\",\"}),(0,e.jsx)(n.mi,{children:\"t\"}),(0,e.jsx)(n.mi,{children:\"a\"}),(0,e.jsx)(n.mi,{children:\"r\"}),(0,e.jsx)(n.mi,{children:\"g\"}),(0,e.jsx)(n.mi,{children:\"e\"}),(0,e.jsx)(n.mi,{children:\"t\"}),(0,e.jsx)(n.mo,{stretchy:\"false\",children:\")\"})]}),(0,e.jsx)(n.annotation,{encoding:\"application/x-tex\",children:\"(input, target)\"})]})})}),(0,e.jsx)(n.span,{className:\"katex-html\",\"aria-hidden\":\"true\",children:(0,e.jsxs)(n.span,{className:\"base\",children:[(0,e.jsx)(n.span,{className:\"strut\",style:{height:\"1em\",verticalAlign:\"-0.25em\"}}),(0,e.jsx)(n.span,{className:\"mopen\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"mord mathnormal\",children:\"in\"}),(0,e.jsx)(n.span,{className:\"mord mathnormal\",children:\"p\"}),(0,e.jsx)(n.span,{className:\"mord mathnormal\",children:\"u\"}),(0,e.jsx)(n.span,{className:\"mord mathnormal\",children:\"t\"}),(0,e.jsx)(n.span,{className:\"mpunct\",children:\",\"}),(0,e.jsx)(n.span,{className:\"mspace\",style:{marginRight:\"0.1667em\"}}),(0,e.jsx)(n.span,{className:\"mord mathnormal\",children:\"t\"}),(0,e.jsx)(n.span,{className:\"mord mathnormal\",children:\"a\"}),(0,e.jsx)(n.span,{className:\"mord mathnormal\",style:{marginRight:\"0.02778em\"},children:\"r\"}),(0,e.jsx)(n.span,{className:\"mord mathnormal\",style:{marginRight:\"0.03588em\"},children:\"g\"}),(0,e.jsx)(n.span,{className:\"mord mathnormal\",children:\"e\"}),(0,e.jsx)(n.span,{className:\"mord mathnormal\",children:\"t\"}),(0,e.jsx)(n.span,{className:\"mclose\",children:\")\"})]})})]}),\"\\u6765\\u8BAD\\u7EC3transformer\\uFF0C\\u65E2\\u53EF\\u4EE5\\u63D0\\u5347\\u6548\\u7387\\uFF0C\\u4E5F\\u80FD\\u8BA9transformer\\u5728\\u63A8\\u7406\\u65F6\\u9002\\u5E94\\u4E0D\\u540C\\u7684\\u6587\\u5B57\\u8F93\\u5165\\u957F\\u5EA6\\uFF0C\\u751A\\u81F3\\u53EF\\u4EE5\\u53EA\\u4F7F\\u75281\\u4E2A\\u5B57\\u7B26\\u4F5C\\u4E3A\\u8F93\\u5165\\u8FDB\\u884C\\u9884\\u6D4B\\u3002 \\u6211\\u4EEC\\u8FD8\\u4F1A\\u8BBE\\u7F6Ebatch size\\uFF0C\\u8FD9\\u6837\\u53EF\\u4EE5\\u540C\\u65F6\\u5904\\u7406\\u591A\\u4E2A\\u6570\\u636E\\u3002\\u800Cbatch\\u7684\\u83B7\\u53D6\\uFF0C \\u4F1A\\u968F\\u673A\\u7684\\u4ECE\\u8BAD\\u7EC3\\u6570\\u636E\\u4E2D\\u8FDB\\u884C\\u91C7\\u6837\\u3002\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"manual_seed\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1337\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"batch_size \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# how many independent sequences will we process in parallel?\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"block_size \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# what is the maximum context length for predictions?\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"get_batch\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"split\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# generate a small batch of data of inputs x and targets y\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    data \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" train_data \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" split \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'train'\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"else\"}),` val_data\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    ix \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"randint\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" block_size\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"batch_size\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    x \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"stack\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"i\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\"block_size\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" ix\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    y \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"stack\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"i\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\"block_size\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" ix\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" x\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),` y\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u6211\\u4EEC\\u53EF\\u4EE5\\u5C06\\u91C7\\u6837\\u5F97\\u5230\\u7684\\u6570\\u636E\\u6253\\u5370\\u51FA\\u6765\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"xb\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" yb \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" get_batch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'train'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'inputs:'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"xb\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"xb\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'targets:'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"yb\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"yb\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'----'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" b \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"range\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"batch_size\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# batch dimension\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" t \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"range\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"block_size\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# time dimension\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        context \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" xb\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"t\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        target \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" yb\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"when input is '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"context\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"tolist\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:\" the target: \"}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"target\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u6253\\u5370\\u7ED3\\u679C\\uFF1A\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-js\",children:(0,e.jsxs)(n.code,{className:\"language-js code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"inputs\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Size\"})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"tensor\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"24\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"43\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"57\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"46\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"43\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"44\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"53\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"56\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"46\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"39\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"52\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"46\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"39\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"25\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"17\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"27\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"21\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"54\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"targets\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Size\"})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"tensor\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"43\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"57\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"46\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"43\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"39\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"53\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"56\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"46\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"39\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"46\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"39\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"46\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"17\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"27\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"21\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"54\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"39\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"--\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"--\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"when input is \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"24\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" the target\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"43\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"when input is \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"24\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"43\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" the target\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"58\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\\xB7\\xB7\\xB7\n`})]})}),`\n`,(0,e.jsxs)(n.h4,{id:\"simplest-baseline-bigram-language-model-loss-generation\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#simplest-baseline-bigram-language-model-loss-generation\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"simplest baseline: bigram language model, loss, generation\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u8BA9\\u6211\\u4EEC\\u4ECE\\u4E00\\u4E2A\\u6700\\u7B80\\u5355\\u7684\\u795E\\u7ECF\\u7F51\\u7EDC\\u8BED\\u8A00\\u6A21\\u578B\\u5F00\\u59CB\\uFF0C\\u5373\",(0,e.jsx)(n.em,{children:\"bigram language model\"}),\"\\u3002\\u5728\",(0,e.jsx)(n.code,{children:\"__init__\"}),\"\\u4E2D\\uFF0C\\u6211\\u4EEC\\u4F7F\\u7528nn.Embedding\\u5B9A\\u4E49\\u4E86token_embedding_table\\uFF0C\\u5176\\u662F\\u4E00\\u4E2A\\u5927\\u5C0F\\u4E3Avocab_size*vocab_size\\u7684\\u77E9\\u9635\\uFF0C\\u5F53\\u8F93\\u5165\\u4E00\\u4E2A\\u5B57\\u7B26\\u7684idx\\uFF1A\",(0,e.jsx)(n.code,{children:\"self.token_embedding_table(idx)\"}),\"\\uFF0C\\u4FBF\\u4F1A\\u4ECE\\u8FD9\\u4E2A\\u77E9\\u9635\\u4E2D\\u5F97\\u5230\\u5BF9\\u5E94\\u7684\\u4E00\\u884C\\u5411\\u91CF\\uFF0C\\u4F8B\\u5982\\u6211\\u4EEC\\u8F93\\u516524\\uFF0C\\u5C31\\u4F1A\\u5F97\\u5230\\u7B2C24\\u884C\\u7684\\u6570\\u636E\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u5728\\u8BAD\\u7EC3\\u8FC7\\u7A0B\\u4E2D\\uFF0Cforward\\u51FD\\u6570\\u4E2D\\u7684\",(0,e.jsx)(n.code,{children:\"idx\"}),\"\\uFF0C\\u5176\\u5F62\\u72B6\\u662F\",(0,e.jsx)(n.code,{children:\"batch_size*time\"}),\"\\uFF0C\\u7ECF\\u8FC7embedding\\uFF0C\\u6211\\u4EEC\\u4F1A\\u5F97\\u5230\\u5F62\\u72B6\\u4E3A\",(0,e.jsx)(n.code,{children:\"batch_size*time*channel\"}),\"\\u7684\\u5F20\\u91CFlogits\\uFF0C\\u5176\\u4E3A\\u7F51\\u7EDC\\u8F93\\u51FA\\u7684\\u539F\\u59CB\\u9884\\u6D4B\\u503C\\uFF0C\\u662F\\u672A\\u7ECF\\u8FC7\\u5F52\\u4E00\\u5316\\u7684\\u3002\\u7EE7\\u7EED\\u770Bforward\\u51FD\\u6570\\uFF0C\\u5F53\\u5B58\\u5728targets\\uFF08\\u4E3A\\u8BAD\\u7EC3\\u8FC7\\u7A0B\\uFF09\\u65F6\\uFF0C\\u9996\\u5148\\u5C06logits\\u3001targets\\u8FDB\\u884Creshape\\uFF0C\\u518D\\u4F7F\\u7528\\u4EA4\\u53C9\\u71B5\\u51FD\\u6570\\u8BA1\\u7B97loss\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u5728\\u8BAD\\u7EC3\\u5B8C\\u6210\\u540E\\uFF0C\\u53EF\\u4EE5\\u4F7F\\u7528\\u8BAD\\u7EC3\\u597D\\u7684\\u6A21\\u578B\\u751F\\u6210\\u8FDE\\u7EED\\u7684\\u5B57\\u7B26\\uFF0C\\u4E5F\\u5C31\\u662F\\u51FD\\u6570\",(0,e.jsx)(n.code,{children:\"generate\"}),\"\\u6240\\u505A\\u7684\\u4E8B\\u3002\\u9996\\u5148\\uFF0C\\u6700\\u5927\\u7684\\u5B57\\u7B26\\u751F\\u6210\\u957F\\u5EA6\\u4E3A\",(0,e.jsx)(n.code,{children:\"max_new_tokens\"}),\"\\uFF0C\\u5FAA\\u73AF\\u5F00\\u59CB\\uFF0C\\u5411forward\\u51FD\\u6570\\u4E2D\\u8F93\\u5165\\u5F53\\u524D\\u7684idx\\uFF0C\\u5F97\\u5230logits\\uFF0C\\u53D6\\u65F6\\u95F4\\u7EF4\\u5EA6\\u4E0A\\u7684\\u6700\\u540E\\u4E00\\u7EF4\\uFF08\\u5B57\\u7B26\\u4E32\\u7684\\u6700\\u540E\\u4E00\\u4E2A\\u5B57\\u7B26\\uFF09\\uFF0C\\u7ECF\\u8FC7softmax\\u5F52\\u4E00\\u5316\\u5F97\\u5230\\u6982\\u7387\\uFF0C\\u518D\\u6839\\u636E\\u6982\\u7387\\u5F97\\u5230\\u4E0B\\u4E00\\u4E2A\\u5B57\\u7B26\\u7684idx\\uFF0C\\u6700\\u540E\\u5C06\\u5F53\\u524D\\u7684\\u9884\\u6D4B\\u7ED3\\u679Cidx_next\\u4E0E\\u4E4B\\u524D\\u7684idx\\u8FDB\\u884C\\u5408\\u5E76\\uFF0C\\u8FD9\\u6837\\u4FBF\\u53EF\\u4EE5\\u5F97\\u5230\\u5F53\\u524D\\u7684\\u6700\\u65B0\\u5B57\\u7B26\\u5E8F\\u5217\\u3002\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` torch\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"nn \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),` nn\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"nn \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" functional \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),` F\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"manual_seed\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1337\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"BigramLanguageModel\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"nn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Module\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"__init__\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" vocab_size\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"super\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"__init__\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# each token directly reads off the logits for the next token from a lookup table\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"token_embedding_table \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" nn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Embedding\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"vocab_size\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" vocab_size\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"forward\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" idx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" targets\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"None\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# idx and targets are both (B,T) tensor of integers\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        logits \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"token_embedding_table\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"idx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# (B,T,C)\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        \n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" targets \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"is\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"None\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            loss \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"None\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"else\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            B\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" T\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" C \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" logits\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`shape\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            logits \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" logits\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"view\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"B\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"T\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" C\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            targets \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" targets\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"view\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"B\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"T\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            loss \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" F\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"cross_entropy\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"logits\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" targets\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" logits\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),` loss\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    \n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"generate\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" idx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" max_new_tokens\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# idx is (B, T) array of indices in the current context\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" _ \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"range\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"max_new_tokens\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# get the predictions\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            logits\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" loss \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"idx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# focus only on the last time step\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            logits \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" logits\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# becomes (B, C)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# apply softmax to get probabilities\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            probs \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" F\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"softmax\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"logits\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" dim\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# (B, C)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# sample from the distribution\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            idx_next \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"multinomial\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"probs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" num_samples\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# (B, 1)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# append sampled index to the running sequence\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            idx \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"cat\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"idx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" idx_next\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" dim\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# (B, T+1)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),` idx\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u57FA\\u4E8E\\u8FD9\\u4E2A\\u6A21\\u578B\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u751F\\u6210\\u4E00\\u4E2A\\u957F\\u5EA6\\u4E3A100\\u7684\\u5B57\\u7B26\\u4E32\\u5E8F\\u5217\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"m \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" BigramLanguageModel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"vocab_size\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"logits\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" loss \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" m\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"xb\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" yb\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"logits\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"loss\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"decode\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"m\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"generate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"idx \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"zeros\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" dtype\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"long\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" max_new_tokens\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"100\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"tolist\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u6253\\u5370\\u7ED3\\u679C\\u5982\\u4E0B\\uFF1A\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-js\",children:(0,e.jsxs)(n.code,{className:\"language-js code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Size\"})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"32\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"65\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"tensor\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"4.8786\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" grad_fn\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"NllLossBackward0\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"SKIcLT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"AcELMoTbvZv\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"C\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"?\"}),\"nq\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"QE33\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"CJqkOKH\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\"q\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\"la\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"oiywkHjgChzbQ\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"?\"}),\"u\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`3bLIgwevmyFJGUGp\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"wnYWmnxKWWev\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),`tDqXErVKLgJ\n`]})]})}),`\n`,(0,e.jsxs)(n.h4,{id:\"training-the-bigram-model\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#training-the-bigram-model\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"training the bigram model\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u63A5\\u4E0B\\u6765\\uFF0C\\u8BA9\\u6211\\u4EEC\\u5F00\\u59CB\\u8BAD\\u7EC3\\u6A21\\u578B\\uFF0C\\u9996\\u5148\\u52A0\\u5165AdamW\\u4F18\\u5316\\u5668\\uFF0C\\u7136\\u540E\\u8BBE\\u7F6E100\\u6B21\\u5FAA\\u73AF\\u8FED\\u4EE3\\uFF0C\\u4E00\\u6B21\\u5FAA\\u73AF\\u7684\\u6B65\\u9AA4\\u5982\\u4E0B\\uFF1A\"}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsx)(n.li,{children:\"\\u83B7\\u53D6batch\\u6570\\u636E\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u6A21\\u578B\\u9884\\u6D4B\\u5F97\\u5230loss\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u6E05\\u7A7A\\u4F18\\u5316\\u5668\\u4E4B\\u524D\\u7684\\u68AF\\u5EA6\\u4FE1\\u606F\"}),`\n`,(0,e.jsx)(n.li,{children:\"loss\\u53CD\\u4F20\\u5F97\\u5230\\u68AF\\u5EA6\"}),`\n`,(0,e.jsx)(n.li,{children:\"optimizer\\u57FA\\u4E8E\\u68AF\\u5EA6\\u4FE1\\u606F\\u66F4\\u65B0\\u6A21\\u578B\\u53C2\\u6570\"}),`\n`]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# create a PyTorch optimizer\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"optimizer \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"optim\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"AdamW\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"m\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"parameters\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" lr\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1e-3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"batch_size \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"32\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" steps \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"range\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"100\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# increase number of steps for good results... \"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    \n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# sample a batch of data\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    xb\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" yb \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" get_batch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'train'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# evaluate the loss\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    logits\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" loss \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" m\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"xb\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" yb\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    optimizer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"zero_grad\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"set_to_none\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"True\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    loss\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"backward\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    optimizer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"step\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"loss\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"item\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u6700\\u7EC8\\u8FD9\\u4E2A\\u6A21\\u578B\\u7684\\u8BAD\\u7EC3\\u6548\\u679C\\u5E76\\u4E0D\\u597D\\uFF0C\\u8FED\\u4EE3100\\u6B21\\u4E4B\\u540E\\uFF0Closs\\u4E3A4.66\\uFF0C\\u6253\\u5370\\u9884\\u6D4B\\u7684\\u5B57\\u7B26\\u5E8F\\u5217\\uFF1A\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"decode\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"m\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"generate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"idx \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"zeros\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" dtype\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"torch\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"long\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" max_new_tokens\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"500\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"tolist\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u6253\\u5370\\u7ED3\\u679C\\uFF1A\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-js\",children:(0,e.jsxs)(n.code,{className:\"language-js code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"oTo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"JUZ\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"zqe\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"xBP qbs$Gy'\",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"AcOmrLwwt\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"p$x\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Seh\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\"onQbfM\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"?\"}),(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"OjKbn\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'NwUAW -Np3fkz$FVwAUEa-wzWC -wQo-R!v -Mj?,SPiTyZ;o-opr$mOiPJEYD-CfigkzD3p3?zvS;ADz;.y?o,ivCuC'\"}),`zqHxcVT cHA\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"rT'\",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Fd\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"SBMZyOslg\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"NXeF$sBe\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"juUzLq\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"?\"}),\"w\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\"wzP\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),`h\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"ERjjxlgJzPbHxf$\"}),\" q\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"q\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"KCDCU\"}),` fqBOQT\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token constant\",children:\"SV\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"&\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"CW\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\"xSVwZv\",(0,e.jsx)(n.span,{className:\"token string\",children:\"'DG'\"}),(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"NSPypDhKStKzC\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\"$hslxIVzoivnp \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"ethA\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"NCCGoi\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"tN\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"ljjP3fwJMwNelgUzzPGJlgihJ\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"d\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"?\"}),\"q\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"d\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`pSPYgCuCJrIFtb\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`jQXg\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"pA\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"P\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"LP\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"SPJi\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"DBcuBM\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"CixjJ$Jzkq\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"OLf3KLQLMGph$\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"O\"}),\" 3DfiPHnXKuHMlyjxEiyZib3FaHV\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\"oJa\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"zoc\",(0,e.jsx)(n.span,{className:\"token string\",children:\"'XSP :CKGUhd?lgCOF$;;DTHZMlvvcmZAm;:iv'\"}),(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"MMgO\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"&\"}),(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Ywbc\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"BLCUd\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"&\"}),`vZINLIzkuTGZa\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token constant\",children:\"D\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"?\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.h2,{id:\"\\u7ED3\\u8BBA\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u7ED3\\u8BBA\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u7ED3\\u8BBA\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u81F3\\u6B64\\uFF0C\\u6211\\u4EEC\\u642D\\u5EFA\\u4E86\\u4E00\\u4E2A\\u6700\\u7B80\\u5355\\u7684\\u8BED\\u8A00\\u6A21\\u578B\\uFF0C\\u867D\\u7136\\u76EE\\u524D\\u7684\\u7ED3\\u679C\\u5E76\\u4E0D\\u597D\\uFF0C\\u4F46\\u662F\\u63A5\\u4E0B\\u6765\\u7684\\u6587\\u7AE0\\u4E2D\\uFF0C\\u6211\\u4EEC\\u5C06\\u5F15\\u5165self attention\\u4EE5\\u53CAtransformer\\uFF0C\\u8FD9\\u5C06\\u5927\\u5927\\u63D0\\u5347\\u6A21\\u578B\\u7684\\u6548\\u679C\\uFF0C\\u656C\\u8BF7\\u671F\\u5F85:)\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"\\u53C2\\u8003\",className:\"content-header\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u53C2\\u8003\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\u53C2\\u8003\"]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://www.youtube.com/watch?v=kCc8FmEb1nY&list=PLAqhIrjkxbuWI23v9cThsA9GvCAUhRvKZ&index=8\",children:\"video\"}),\"\\uFF0C\",(0,e.jsx)(n.a,{href:\"https://colab.research.google.com/drive/1JMLa53HDuA-i7ZBmqV7ZnA3c_fvtXnx-?usp=sharing\",children:\"Google colab \"}),\"\\uFF0C\",(0,e.jsx)(n.a,{href:\"https://github.com/karpathy/nanoGPT\",children:\"karpathy/nanoGPT\"}),\"\\uFF0C\",(0,e.jsx)(n.a,{href:\"https://github.com/karpathy/ng-video-lecture\",children:\"karpathy/ng-video-lecture\"})]})]})}function d(a={}){let{wrapper:n}=a.components||{};return n?(0,e.jsx)(n,{...a,children:(0,e.jsx)(p,{...a})}):p(a)}return w(x);})();\n;return Component;"
  },
  "_id": "blog/AI/gbt-build-fom-scratch-1.md",
  "_raw": {
    "sourceFilePath": "blog/AI/gbt-build-fom-scratch-1.md",
    "sourceFileName": "gbt-build-fom-scratch-1.md",
    "sourceFileDir": "blog/AI",
    "contentType": "markdown",
    "flattenedPath": "blog/AI/gbt-build-fom-scratch-1"
  },
  "type": "Blog",
  "readingTime": {
    "text": "14 min read",
    "minutes": 13.81,
    "time": 828600,
    "words": 2762
  },
  "slug": "gbt-build-fom-scratch-1",
  "path": "blog/AI/gbt-build-fom-scratch-1",
  "toc": [
    {
      "value": "简介",
      "url": "#简介",
      "depth": 2
    },
    {
      "value": "ChatGPT, Transformers, nanoGPT, Shakespeare",
      "url": "#chatgpt-transformers-nanogpt-shakespeare",
      "depth": 3
    },
    {
      "value": "代码",
      "url": "#代码",
      "depth": 2
    },
    {
      "value": "baseline language modeling, code setup",
      "url": "#baseline-language-modeling-code-setup",
      "depth": 3
    },
    {
      "value": "reading and exploring the data",
      "url": "#reading-and-exploring-the-data",
      "depth": 4
    },
    {
      "value": "tokenization, train/val split",
      "url": "#tokenization-trainval-split",
      "depth": 4
    },
    {
      "value": "data loader: batches of chunks of data",
      "url": "#data-loader-batches-of-chunks-of-data",
      "depth": 4
    },
    {
      "value": "simplest baseline: bigram language model, loss, generation",
      "url": "#simplest-baseline-bigram-language-model-loss-generation",
      "depth": 4
    },
    {
      "value": "training the bigram model",
      "url": "#training-the-bigram-model",
      "depth": 4
    },
    {
      "value": "结论",
      "url": "#结论",
      "depth": 2
    },
    {
      "value": "参考",
      "url": "#参考",
      "depth": 2
    }
  ],
  "structuredData": {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Let's build GPT: from scratch, in code, spelled out (1)",
    "datePublished": "2023-01-20T00:00:00.000Z",
    "dateModified": "2023-01-20T00:00:00.000Z",
    "description": "a shocking turn of events a leaf has fallen from a treat in the local park Witnesses report that the leaf which was previously attached to a branch of",
    "url": "https://zhangjian94cn.github.io/blog/gbt-build-fom-scratch-1"
  }
}