{
  "title": "Learn Makefiles (2)",
  "date": "2022-12-13T00:00:00.000Z",
  "tags": [
    "Compilation",
    "Make"
  ],
  "draft": false,
  "summary": "Getting Advanced: Targets, Automatic Variables and Wildcards, Fancy Rules",
  "authors": [
    "default"
  ],
  "body": {
    "raw": "\n本文是对[Makefile Cookbook](https://makefiletutorial.com/#makefile-cookbook)的简要翻译\n\n## Targets\n\n### The `all` target\n\n如果想要同时运行所有的`target`，可以使用`all` target。之所以可以这样，原因是：如果不指定target，make总是运行第一条rule。\n\n```makefile\nall: one two three\n\none:\n\ttouch one\ntwo:\n\ttouch two\nthree:\n\ttouch three\n\nclean:\n\trm -f one two three\n```\n\n### Multiple targets\n\n当多个targets对应同一个rule时，那么每一个target都会执行此rule的commands（参考下面的例子）。其中，`$@`是[automatic variable](https://makefiletutorial.com/#automatic-variables)，其包含了target name。\n\n```makefile\nall: f1.o f2.o\n\nf1.o f2.o:\n\techo $@\n# Equivalent to:\n# f1.o:\n#\t echo f1.o\n# f2.o:\n#\t echo f2.o\n```\n\n## Automatic Variables and Wildcards\n\n`*`和`%`在make中被称为wildcards（通配符）。\n\n### 通配符 `*`\n\n`*`含义基本和正则表达式一致。在使用`*`的同时，最好也使用`wildcard `function，要不然可能会出现一些问题。\n\n```makefile\n# Print out file information about every .c file\nprint: $(wildcard *.c)\n\tls -la  $?\n```\n\n- `*`可以在target，prerequisites，`wildcard` function中使用\n- 注意：`*`不可以直接用于变量的定义\n- 注意：如果`*`没有和任何文件匹配，那么就会直接变成字符`*`（除非你使用`wildcard` function）\n\n\n```makefile\nthing_wrong := *.o # Don't do this! '*' will not get expanded\nthing_right := $(wildcard *.o)\n\nall: one two three four\n\n# Fails, because $(thing_wrong) is the string \"*.o\"\none: $(thing_wrong)\n\n# Stays as *.o if there are no files that match this pattern :(\ntwo: *.o \n\n# Works as you would expect! In this case, it does nothing.\nthree: $(thing_right)\n\n# Same as rule three\nfour: $(wildcard *.o)\n```\n\n### 通配符 `%`\n\n`%`是非常有用的，但是在某些情况下，它的用法会让人感到困惑。\n\n- 匹配模式：`%`会匹配字符串中一个或多个字符。This match is called the stem.\n- 替换模式：将匹配上的stem进行替换。\n- `%`通常被使用在`rule definitions`中，此外还会被用于一些函数。\n\n下面几节讲了一些替换的例子：\n\n- Static Pattern Rules\n- Pattern Rules\n- String Substitution\n- The vpath Directive\n\n### 自动变量（Automatic Variables）\n\n[automatic variables](https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html)有很多，下面几个是比较常用的：\n\n```makefile\nhey: one two\n\t# Outputs \"hey\", since this is the target name\n\techo $@\n\n\t# Outputs all prerequisites newer than the target\n\techo $?\n\n\t# Outputs all prerequisites\n\techo $^\n\n\ttouch hey\n\none:\n\ttouch one\n\ntwo:\n\ttouch two\n\nclean:\n\trm -f hey one two\n```\n\n## Fancy Rules\n\n### Implicit Rules\n\n下面的几个命令都是make中的隐式命令：\n- C程序的编译：blah.o自动由blah.c编译得到，其命令如下：`$(CC) -c $(CPPFLAGS) $(CFLAGS) $^ -o $@`\n- C++程序的编译：blah.o自动由blah.cc/blah.cpp编译得到，其命令如下：`$(CXX) -c $(CPPFLAGS) $(CXXFLAGS) $^ -o $@`\n- 目标文件的链接：可执行文件blah自动由blah.o生成，其命令如下`$(CC) $(LDFLAGS) $^ $(LOADLIBES) $(LDLIBS) -o $@`\n\n下面是一个编译C程序的例子，仔细观察其Implicit Rules的使用。\n```makefile\nCC = gcc # Flag for implicit rules\nCFLAGS = -g # Flag for implicit rules. Turn on debug info\n\n# Implicit rule #1: blah is built via the C linker implicit rule\n# Implicit rule #2: blah.o is built via the C compilation implicit rule, because blah.c exists\nblah: blah.o\n\nblah.c:\n\techo \"int main() { return 0; }\" > blah.c\n\nclean:\n\trm -f blah*\n```\n\n其中，有一些比较重要的变量：\n\n- CC: Program for compiling C programs; default cc\n- CXX: Program for compiling C++ programs; default g++\n- CFLAGS: Extra flags to give to the C compiler\n- CXXFLAGS: Extra flags to give to the C++ compiler\n- CPPFLAGS: Extra flags to give to the C preprocessor\n- LDFLAGS: Extra flags to give to compilers when they are supposed to invoke the linker\n\n### Static Pattern Rules\n\n形式如下：\n```makefile\ntargets...: target-pattern: prereq-patterns ...\n   commands\n```\n\n通过target-pattern（使用通配符`%`）来匹配target，符合的target会对应于prereq-patterns\n\n接下来，让我们通过一个例子来比较下是否使用Static Pattern Rules的区别：\n\n```makefile\n# 未使用的\nobjects = foo.o bar.o all.o\nall: $(objects)\n\n# These files compile via implicit rules\nfoo.o: foo.c\nbar.o: bar.c\nall.o: all.c\n\nall.c:\n\techo \"int main() { return 0; }\" > all.c\n\n%.c:\n\ttouch $@\n\nclean:\n\trm -f *.c *.o all\n```\n\n\n```makefile\n# 使用了static pattern rule的，Makefile会更加简洁\nobjects = foo.o bar.o all.o\nall: $(objects)\n\n# These files compile via implicit rules\n# Syntax - targets ...: target-pattern: prereq-patterns ...\n# In the case of the first target, foo.o, the target-pattern matches foo.o and sets the \"stem\" to be \"foo\".\n# It then replaces the '%' in prereq-patterns with that stem\n$(objects): %.o: %.c\n\nall.c:\n\techo \"int main() { return 0; }\" > all.c\n\n%.c:\n\ttouch $@\n\nclean:\n\trm -f *.c *.o all\n```\n\n### Static Pattern Rules and Filter\n\n（target-pattern不是已经起到filter作用吗？为什么还需要filter function？）\n\n```makefile\nobj_files = foo.result bar.o lose.o\nsrc_files = foo.raw bar.c lose.c\n\nall: $(obj_files)\n# Note: PHONY is important here. Without it, implicit rules will try to build the executable \"all\", since the prereqs are \".o\" files.\n.PHONY: all \n\n# Ex 1: .o files depend on .c files. Though we don't actually make the .o file.\n$(filter %.o,$(obj_files)): %.o: %.c\n\techo \"target: $@ prereq: $<\"\n\n# Ex 2: .result files depend on .raw files. Though we don't actually make the .result file.\n$(filter %.result,$(obj_files)): %.result: %.raw\n\techo \"target: $@ prereq: $<\" \n\n%.c %.raw:\n\ttouch $@\n\nclean:\n\trm -f $(src_files)\n```\n\n\n\n### Pattern Rules\n\nPattern rules一般会在下面两种情况下出现：\n1. 定义自己的implicit rules\n2. 形式更简单的static pattern rules\n\n下面是两个简单的例子：\n```makefile\n# Define a pattern rule that compiles every .c file into a .o file\n%.o : %.c\n\t\t$(CC) -c $(CFLAGS) $(CPPFLAGS) $< -o $@\n```\n\n```makefile\n# Define a pattern rule that has no pattern in the prerequisites.\n# This just creates empty .c files when needed.\n%.c:\n   touch $@\n```\n\n### Double-Colon Rules\n\n双冒号规则很少被使用，它可以允许对一个target定义多个rule。而如果你直接对一个target使用单引号定义多个规则，那么会出现警告（and only the second set of commands would run.）。\n\n```makefile\nall: blah\n\nblah::\n\techo \"hello\"\n\nblah::\n\techo \"hello again\"\n```\n\n",
    "code": "var Component=(()=>{var m=Object.create;var c=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var g=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),b=(a,e)=>{for(var l in e)c(a,l,{get:e[l],enumerable:!0})},t=(a,e,l,i)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let s of N(e))!k.call(a,s)&&s!==l&&c(a,s,{get:()=>e[s],enumerable:!(i=p(e,s))||i.enumerable});return a};var f=(a,e,l)=>(l=a!=null?m(u(a)):{},t(e||!a||!a.__esModule?c(l,\"default\",{value:a,enumerable:!0}):l,a)),y=a=>t(c({},\"__esModule\",{value:!0}),a);var o=g((C,r)=>{r.exports=_jsx_runtime});var $={};b($,{default:()=>h,frontmatter:()=>v});var n=f(o()),v={title:\"Learn Makefiles (2)\",date:\"2022-12-13\",tags:[\"Compilation\",\"Make\"],draft:!1,summary:\"Getting Advanced: Targets, Automatic Variables and Wildcards, Fancy Rules\",authors:[\"default\"]};function d(a){let e={a:\"a\",code:\"code\",h2:\"h2\",h3:\"h3\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",ul:\"ul\",...a.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[\"\\u672C\\u6587\\u662F\\u5BF9\",(0,n.jsx)(e.a,{href:\"https://makefiletutorial.com/#makefile-cookbook\",children:\"Makefile Cookbook\"}),\"\\u7684\\u7B80\\u8981\\u7FFB\\u8BD1\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"targets\",className:\"content-header\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#targets\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Targets\"]}),`\n`,(0,n.jsxs)(e.h3,{id:\"the-all-target\",className:\"content-header\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#the-all-target\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"The \",(0,n.jsx)(e.code,{children:\"all\"}),\" target\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5982\\u679C\\u60F3\\u8981\\u540C\\u65F6\\u8FD0\\u884C\\u6240\\u6709\\u7684\",(0,n.jsx)(e.code,{children:\"target\"}),\"\\uFF0C\\u53EF\\u4EE5\\u4F7F\\u7528\",(0,n.jsx)(e.code,{children:\"all\"}),\" target\\u3002\\u4E4B\\u6240\\u4EE5\\u53EF\\u4EE5\\u8FD9\\u6837\\uFF0C\\u539F\\u56E0\\u662F\\uFF1A\\u5982\\u679C\\u4E0D\\u6307\\u5B9Atarget\\uFF0Cmake\\u603B\\u662F\\u8FD0\\u884C\\u7B2C\\u4E00\\u6761rule\\u3002\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-makefile\",children:(0,n.jsxs)(e.code,{className:\"language-makefile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"all\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` one two three\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"one\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\ttouch one\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"two\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\ttouch two\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"three\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\ttouch three\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"clean\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\trm -f one two three\n`})]})}),`\n`,(0,n.jsxs)(e.h3,{id:\"multiple-targets\",className:\"content-header\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#multiple-targets\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Multiple targets\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5F53\\u591A\\u4E2Atargets\\u5BF9\\u5E94\\u540C\\u4E00\\u4E2Arule\\u65F6\\uFF0C\\u90A3\\u4E48\\u6BCF\\u4E00\\u4E2Atarget\\u90FD\\u4F1A\\u6267\\u884C\\u6B64rule\\u7684commands\\uFF08\\u53C2\\u8003\\u4E0B\\u9762\\u7684\\u4F8B\\u5B50\\uFF09\\u3002\\u5176\\u4E2D\\uFF0C\",(0,n.jsx)(e.code,{children:\"$@\"}),\"\\u662F\",(0,n.jsx)(e.a,{href:\"https://makefiletutorial.com/#automatic-variables\",children:\"automatic variable\"}),\"\\uFF0C\\u5176\\u5305\\u542B\\u4E86target name\\u3002\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-makefile\",children:(0,n.jsxs)(e.code,{className:\"language-makefile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"all\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` f1.o f2.o\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"f1.o f2.o\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\techo \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$@\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Equivalent to:\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# f1.o:\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"#\t echo f1.o\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# f2.o:\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"#\t echo f2.o\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"automatic-variables-and-wildcards\",className:\"content-header\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#automatic-variables-and-wildcards\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Automatic Variables and Wildcards\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"*\"}),\"\\u548C\",(0,n.jsx)(e.code,{children:\"%\"}),\"\\u5728make\\u4E2D\\u88AB\\u79F0\\u4E3Awildcards\\uFF08\\u901A\\u914D\\u7B26\\uFF09\\u3002\"]}),`\n`,(0,n.jsxs)(e.h3,{id:\"\\u901A\\u914D\\u7B26-\",className:\"content-header\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u901A\\u914D\\u7B26-\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u901A\\u914D\\u7B26 \",(0,n.jsx)(e.code,{children:\"*\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"*\"}),\"\\u542B\\u4E49\\u57FA\\u672C\\u548C\\u6B63\\u5219\\u8868\\u8FBE\\u5F0F\\u4E00\\u81F4\\u3002\\u5728\\u4F7F\\u7528\",(0,n.jsx)(e.code,{children:\"*\"}),\"\\u7684\\u540C\\u65F6\\uFF0C\\u6700\\u597D\\u4E5F\\u4F7F\\u7528\",(0,n.jsx)(e.code,{children:\"wildcard \"}),\"function\\uFF0C\\u8981\\u4E0D\\u7136\\u53EF\\u80FD\\u4F1A\\u51FA\\u73B0\\u4E00\\u4E9B\\u95EE\\u9898\\u3002\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-makefile\",children:(0,n.jsxs)(e.code,{className:\"language-makefile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Print out file information about every .c file\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"wildcard\"}),\" *.c\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tls -la  \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$?\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"*\"}),\"\\u53EF\\u4EE5\\u5728target\\uFF0Cprerequisites\\uFF0C\",(0,n.jsx)(e.code,{children:\"wildcard\"}),\" function\\u4E2D\\u4F7F\\u7528\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u6CE8\\u610F\\uFF1A\",(0,n.jsx)(e.code,{children:\"*\"}),\"\\u4E0D\\u53EF\\u4EE5\\u76F4\\u63A5\\u7528\\u4E8E\\u53D8\\u91CF\\u7684\\u5B9A\\u4E49\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u6CE8\\u610F\\uFF1A\\u5982\\u679C\",(0,n.jsx)(e.code,{children:\"*\"}),\"\\u6CA1\\u6709\\u548C\\u4EFB\\u4F55\\u6587\\u4EF6\\u5339\\u914D\\uFF0C\\u90A3\\u4E48\\u5C31\\u4F1A\\u76F4\\u63A5\\u53D8\\u6210\\u5B57\\u7B26\",(0,n.jsx)(e.code,{children:\"*\"}),\"\\uFF08\\u9664\\u975E\\u4F60\\u4F7F\\u7528\",(0,n.jsx)(e.code,{children:\"wildcard\"}),\" function\\uFF09\"]}),`\n`]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-makefile\",children:(0,n.jsxs)(e.code,{className:\"language-makefile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"thing_wrong \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" *.o \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Don't do this! '*' will not get expanded\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"thing_right \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"wildcard\"}),\" *.o\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"all\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` one two three four\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'# Fails, because $(thing_wrong) is the string \"*.o\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"one\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"thing_wrong\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Stays as *.o if there are no files that match this pattern :(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"two\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` *.o \n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Works as you would expect! In this case, it does nothing.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"three\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"thing_right\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Same as rule three\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"four\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"wildcard\"}),\" *.o\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h3,{id:\"\\u901A\\u914D\\u7B26--1\",className:\"content-header\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u901A\\u914D\\u7B26--1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u901A\\u914D\\u7B26 \",(0,n.jsx)(e.code,{children:\"%\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"%\"}),\"\\u662F\\u975E\\u5E38\\u6709\\u7528\\u7684\\uFF0C\\u4F46\\u662F\\u5728\\u67D0\\u4E9B\\u60C5\\u51B5\\u4E0B\\uFF0C\\u5B83\\u7684\\u7528\\u6CD5\\u4F1A\\u8BA9\\u4EBA\\u611F\\u5230\\u56F0\\u60D1\\u3002\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"\\u5339\\u914D\\u6A21\\u5F0F\\uFF1A\",(0,n.jsx)(e.code,{children:\"%\"}),\"\\u4F1A\\u5339\\u914D\\u5B57\\u7B26\\u4E32\\u4E2D\\u4E00\\u4E2A\\u6216\\u591A\\u4E2A\\u5B57\\u7B26\\u3002This match is called the stem.\"]}),`\n`,(0,n.jsx)(e.li,{children:\"\\u66FF\\u6362\\u6A21\\u5F0F\\uFF1A\\u5C06\\u5339\\u914D\\u4E0A\\u7684stem\\u8FDB\\u884C\\u66FF\\u6362\\u3002\"}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"%\"}),\"\\u901A\\u5E38\\u88AB\\u4F7F\\u7528\\u5728\",(0,n.jsx)(e.code,{children:\"rule definitions\"}),\"\\u4E2D\\uFF0C\\u6B64\\u5916\\u8FD8\\u4F1A\\u88AB\\u7528\\u4E8E\\u4E00\\u4E9B\\u51FD\\u6570\\u3002\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u4E0B\\u9762\\u51E0\\u8282\\u8BB2\\u4E86\\u4E00\\u4E9B\\u66FF\\u6362\\u7684\\u4F8B\\u5B50\\uFF1A\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Static Pattern Rules\"}),`\n`,(0,n.jsx)(e.li,{children:\"Pattern Rules\"}),`\n`,(0,n.jsx)(e.li,{children:\"String Substitution\"}),`\n`,(0,n.jsx)(e.li,{children:\"The vpath Directive\"}),`\n`]}),`\n`,(0,n.jsxs)(e.h3,{id:\"\\u81EA\\u52A8\\u53D8\\u91CFautomatic-variables\",className:\"content-header\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\u81EA\\u52A8\\u53D8\\u91CFautomatic-variables\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u81EA\\u52A8\\u53D8\\u91CF\\uFF08Automatic Variables\\uFF09\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html\",children:\"automatic variables\"}),\"\\u6709\\u5F88\\u591A\\uFF0C\\u4E0B\\u9762\\u51E0\\u4E2A\\u662F\\u6BD4\\u8F83\\u5E38\\u7528\\u7684\\uFF1A\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-makefile\",children:(0,n.jsxs)(e.code,{className:\"language-makefile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"hey\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` one two\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:'# Outputs \"hey\", since this is the target name'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\techo \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$@\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Outputs all prerequisites newer than the target\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\techo \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$?\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Outputs all prerequisites\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\techo \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$^\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\ttouch hey\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"one\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\ttouch one\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"two\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\ttouch two\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"clean\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\trm -f hey one two\n`})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"fancy-rules\",className:\"content-header\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#fancy-rules\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Fancy Rules\"]}),`\n`,(0,n.jsxs)(e.h3,{id:\"implicit-rules\",className:\"content-header\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#implicit-rules\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Implicit Rules\"]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u4E0B\\u9762\\u7684\\u51E0\\u4E2A\\u547D\\u4EE4\\u90FD\\u662Fmake\\u4E2D\\u7684\\u9690\\u5F0F\\u547D\\u4EE4\\uFF1A\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"C\\u7A0B\\u5E8F\\u7684\\u7F16\\u8BD1\\uFF1Ablah.o\\u81EA\\u52A8\\u7531blah.c\\u7F16\\u8BD1\\u5F97\\u5230\\uFF0C\\u5176\\u547D\\u4EE4\\u5982\\u4E0B\\uFF1A\",(0,n.jsx)(e.code,{children:\"$(CC) -c $(CPPFLAGS) $(CFLAGS) $^ -o $@\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"C++\\u7A0B\\u5E8F\\u7684\\u7F16\\u8BD1\\uFF1Ablah.o\\u81EA\\u52A8\\u7531blah.cc/blah.cpp\\u7F16\\u8BD1\\u5F97\\u5230\\uFF0C\\u5176\\u547D\\u4EE4\\u5982\\u4E0B\\uFF1A\",(0,n.jsx)(e.code,{children:\"$(CXX) -c $(CPPFLAGS) $(CXXFLAGS) $^ -o $@\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u76EE\\u6807\\u6587\\u4EF6\\u7684\\u94FE\\u63A5\\uFF1A\\u53EF\\u6267\\u884C\\u6587\\u4EF6blah\\u81EA\\u52A8\\u7531blah.o\\u751F\\u6210\\uFF0C\\u5176\\u547D\\u4EE4\\u5982\\u4E0B\",(0,n.jsx)(e.code,{children:\"$(CC) $(LDFLAGS) $^ $(LOADLIBES) $(LDLIBS) -o $@\"})]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u4E0B\\u9762\\u662F\\u4E00\\u4E2A\\u7F16\\u8BD1C\\u7A0B\\u5E8F\\u7684\\u4F8B\\u5B50\\uFF0C\\u4ED4\\u7EC6\\u89C2\\u5BDF\\u5176Implicit Rules\\u7684\\u4F7F\\u7528\\u3002\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-makefile\",children:(0,n.jsxs)(e.code,{className:\"language-makefile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"CC \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" gcc \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Flag for implicit rules\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"CFLAGS \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" -g \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Flag for implicit rules. Turn on debug info\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Implicit rule #1: blah is built via the C linker implicit rule\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Implicit rule #2: blah.o is built via the C compilation implicit rule, because blah.c exists\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"blah\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` blah.o\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"blah.c\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\techo \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"int main() { return 0; }\"'}),` > blah.c\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"clean\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\trm -f blah*\n`})]})}),`\n`,(0,n.jsx)(e.p,{children:\"\\u5176\\u4E2D\\uFF0C\\u6709\\u4E00\\u4E9B\\u6BD4\\u8F83\\u91CD\\u8981\\u7684\\u53D8\\u91CF\\uFF1A\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"CC: Program for compiling C programs; default cc\"}),`\n`,(0,n.jsx)(e.li,{children:\"CXX: Program for compiling C++ programs; default g++\"}),`\n`,(0,n.jsx)(e.li,{children:\"CFLAGS: Extra flags to give to the C compiler\"}),`\n`,(0,n.jsx)(e.li,{children:\"CXXFLAGS: Extra flags to give to the C++ compiler\"}),`\n`,(0,n.jsx)(e.li,{children:\"CPPFLAGS: Extra flags to give to the C preprocessor\"}),`\n`,(0,n.jsx)(e.li,{children:\"LDFLAGS: Extra flags to give to compilers when they are supposed to invoke the linker\"}),`\n`]}),`\n`,(0,n.jsxs)(e.h3,{id:\"static-pattern-rules\",className:\"content-header\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#static-pattern-rules\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Static Pattern Rules\"]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u5F62\\u5F0F\\u5982\\u4E0B\\uFF1A\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-makefile\",children:(0,n.jsxs)(e.code,{className:\"language-makefile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"targets...\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" target-pattern\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` prereq-patterns ...\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`   commands\n`})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u901A\\u8FC7target-pattern\\uFF08\\u4F7F\\u7528\\u901A\\u914D\\u7B26\",(0,n.jsx)(e.code,{children:\"%\"}),\"\\uFF09\\u6765\\u5339\\u914Dtarget\\uFF0C\\u7B26\\u5408\\u7684target\\u4F1A\\u5BF9\\u5E94\\u4E8Eprereq-patterns\"]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u63A5\\u4E0B\\u6765\\uFF0C\\u8BA9\\u6211\\u4EEC\\u901A\\u8FC7\\u4E00\\u4E2A\\u4F8B\\u5B50\\u6765\\u6BD4\\u8F83\\u4E0B\\u662F\\u5426\\u4F7F\\u7528Static Pattern Rules\\u7684\\u533A\\u522B\\uFF1A\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-makefile\",children:(0,n.jsxs)(e.code,{className:\"language-makefile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# \\u672A\\u4F7F\\u7528\\u7684\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"objects \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` foo.o bar.o all.o\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"all\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"objects\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# These files compile via implicit rules\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"foo.o\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` foo.c\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"bar.o\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` bar.c\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"all.o\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` all.c\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"all.c\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\techo \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"int main() { return 0; }\"'}),` > all.c\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"%.c\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\ttouch \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$@\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"clean\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\trm -f *.c *.o all\n`})]})}),`\n`,(0,n.jsx)(e.pre,{className:\"language-makefile\",children:(0,n.jsxs)(e.code,{className:\"language-makefile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# \\u4F7F\\u7528\\u4E86static pattern rule\\u7684\\uFF0CMakefile\\u4F1A\\u66F4\\u52A0\\u7B80\\u6D01\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"objects \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` foo.o bar.o all.o\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"all\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"objects\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# These files compile via implicit rules\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Syntax - targets ...: target-pattern: prereq-patterns ...\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'# In the case of the first target, foo.o, the target-pattern matches foo.o and sets the \"stem\" to be \"foo\".'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# It then replaces the '%' in prereq-patterns with that stem\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token target symbol\",children:[(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),\"(objects)\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" %.o\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` %.c\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"all.c\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\techo \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"int main() { return 0; }\"'}),` > all.c\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"%.c\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\ttouch \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$@\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"clean\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\trm -f *.c *.o all\n`})]})}),`\n`,(0,n.jsxs)(e.h3,{id:\"static-pattern-rules-and-filter\",className:\"content-header\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#static-pattern-rules-and-filter\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Static Pattern Rules and Filter\"]}),`\n`,(0,n.jsx)(e.p,{children:\"\\uFF08target-pattern\\u4E0D\\u662F\\u5DF2\\u7ECF\\u8D77\\u5230filter\\u4F5C\\u7528\\u5417\\uFF1F\\u4E3A\\u4EC0\\u4E48\\u8FD8\\u9700\\u8981filter function\\uFF1F\\uFF09\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-makefile\",children:(0,n.jsxs)(e.code,{className:\"language-makefile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"obj_files \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` foo.result bar.o lose.o\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"src_files \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` foo.raw bar.c lose.c\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"all\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"obj_files\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'# Note: PHONY is important here. Without it, implicit rules will try to build the executable \"all\", since the prereqs are \".o\" files.'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token builtin-target builtin\",children:\".PHONY\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` all \n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Ex 1: .o files depend on .c files. Though we don't actually make the .o file.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token target symbol\",children:[(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),\"(filter %.o,\",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),\"(obj_files))\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" %.o\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` %.c\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\techo \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"target: $@ prereq: $<\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Ex 2: .result files depend on .raw files. Though we don't actually make the .result file.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token target symbol\",children:[(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),\"(filter %.result,\",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),\"(obj_files))\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" %.result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` %.raw\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\techo \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"target: $@ prereq: $<\"'}),` \n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"%.c %.raw\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\ttouch \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$@\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"clean\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\trm -f \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"src_files\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h3,{id:\"pattern-rules\",className:\"content-header\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#pattern-rules\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Pattern Rules\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Pattern rules\\u4E00\\u822C\\u4F1A\\u5728\\u4E0B\\u9762\\u4E24\\u79CD\\u60C5\\u51B5\\u4E0B\\u51FA\\u73B0\\uFF1A\"}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsx)(e.li,{children:\"\\u5B9A\\u4E49\\u81EA\\u5DF1\\u7684implicit rules\"}),`\n`,(0,n.jsx)(e.li,{children:\"\\u5F62\\u5F0F\\u66F4\\u7B80\\u5355\\u7684static pattern rules\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u4E0B\\u9762\\u662F\\u4E24\\u4E2A\\u7B80\\u5355\\u7684\\u4F8B\\u5B50\\uFF1A\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-makefile\",children:(0,n.jsxs)(e.code,{className:\"language-makefile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Define a pattern rule that compiles every .c file into a .o file\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"%.o\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` %.c\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"CC\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" -c \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"CFLAGS\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"CPPFLAGS\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$<\"}),\" -o \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$@\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.pre,{className:\"language-makefile\",children:(0,n.jsxs)(e.code,{className:\"language-makefile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Define a pattern rule that has no pattern in the prerequisites.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# This just creates empty .c files when needed.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"%.c\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"   touch \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$@\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h3,{id:\"double-colon-rules\",className:\"content-header\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#double-colon-rules\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Double-Colon Rules\"]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u53CC\\u5192\\u53F7\\u89C4\\u5219\\u5F88\\u5C11\\u88AB\\u4F7F\\u7528\\uFF0C\\u5B83\\u53EF\\u4EE5\\u5141\\u8BB8\\u5BF9\\u4E00\\u4E2Atarget\\u5B9A\\u4E49\\u591A\\u4E2Arule\\u3002\\u800C\\u5982\\u679C\\u4F60\\u76F4\\u63A5\\u5BF9\\u4E00\\u4E2Atarget\\u4F7F\\u7528\\u5355\\u5F15\\u53F7\\u5B9A\\u4E49\\u591A\\u4E2A\\u89C4\\u5219\\uFF0C\\u90A3\\u4E48\\u4F1A\\u51FA\\u73B0\\u8B66\\u544A\\uFF08and only the second set of commands would run.\\uFF09\\u3002\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-makefile\",children:(0,n.jsxs)(e.code,{className:\"language-makefile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"all\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` blah\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"blah\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\techo \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"hello\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token target symbol\",children:\"blah\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\techo \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"hello again\"'}),`\n`]})]})})]})}function h(a={}){let{wrapper:e}=a.components||{};return e?(0,n.jsx)(e,{...a,children:(0,n.jsx)(d,{...a})}):d(a)}return y($);})();\n;return Component;"
  },
  "_id": "blog/makefile-advance.md",
  "_raw": {
    "sourceFilePath": "blog/makefile-advance.md",
    "sourceFileName": "makefile-advance.md",
    "sourceFileDir": "blog",
    "contentType": "markdown",
    "flattenedPath": "blog/makefile-advance"
  },
  "type": "Blog",
  "readingTime": {
    "text": "7 min read",
    "minutes": 6.49,
    "time": 389400,
    "words": 1298
  },
  "slug": "makefile-advance",
  "path": "blog/makefile-advance",
  "toc": [
    {
      "value": "Targets",
      "url": "#targets",
      "depth": 2
    },
    {
      "value": "The all target",
      "url": "#the-all-target",
      "depth": 3
    },
    {
      "value": "Multiple targets",
      "url": "#multiple-targets",
      "depth": 3
    },
    {
      "value": "Automatic Variables and Wildcards",
      "url": "#automatic-variables-and-wildcards",
      "depth": 2
    },
    {
      "value": "通配符 *",
      "url": "#通配符-",
      "depth": 3
    },
    {
      "value": "通配符 %",
      "url": "#通配符--1",
      "depth": 3
    },
    {
      "value": "自动变量（Automatic Variables）",
      "url": "#自动变量automatic-variables",
      "depth": 3
    },
    {
      "value": "Fancy Rules",
      "url": "#fancy-rules",
      "depth": 2
    },
    {
      "value": "Implicit Rules",
      "url": "#implicit-rules",
      "depth": 3
    },
    {
      "value": "Static Pattern Rules",
      "url": "#static-pattern-rules",
      "depth": 3
    },
    {
      "value": "Static Pattern Rules and Filter",
      "url": "#static-pattern-rules-and-filter",
      "depth": 3
    },
    {
      "value": "Pattern Rules",
      "url": "#pattern-rules",
      "depth": 3
    },
    {
      "value": "Double-Colon Rules",
      "url": "#double-colon-rules",
      "depth": 3
    }
  ],
  "structuredData": {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Learn Makefiles (2)",
    "datePublished": "2022-12-13T00:00:00.000Z",
    "dateModified": "2022-12-13T00:00:00.000Z",
    "description": "Getting Advanced: Targets, Automatic Variables and Wildcards, Fancy Rules",
    "url": "https://zhangjian94cn.github.io/blog/makefile-advance"
  }
}